<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <title>Musely Scheduler</title>
  <!-- ‚úÖ Early session check to prevent login screen flash -->
  
  
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/layout.css">
  <link rel="stylesheet" href="/css/components.css">
  
  <script src="/app/preamble.js"></script>
</head>
<!-- ‚úÖ Body starts without auth-pending if early check found valid session -->
<body>
  
  <!-- AUTH OVERLAY - Blocks all interaction until signed in -->
  <div id="authOverlay" style="
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    z-index: 99999;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 24px;
  ">
<img
  src="https://i.imgur.com/ndsvLxn.png"
  alt="Company Logo"
  style="
    width:64px;
    height:64px;
    border-radius:16px;
    display:block;
    object-fit:contain;
    box-shadow: 0 8px 32px rgba(0,0,0,0.25);
  "
/>
    <div style="font-size: 24px; font-weight: 700; color: #0f172a;">Scheduling Manager</div>
    <div style="font-size: 14px; color: #64748b; margin-bottom: 8px;">Sign in to continue</div>
    <div id="authLoginContainer">
      <div id="g_id_onload"
           data-client_id="63798769550-6hfbo9bodtej1i6k00ch0i4n523v02v0.apps.googleusercontent.com"
           data-callback="handleSignIn"
           data-auto_prompt="false"></div>
      <div class="g_id_signin" data-type="standard" data-size="large"></div>
    </div>
    <div style="margin-top: 32px; font-size: 11px; color: #94a3b8;">Musely Support Team</div>
  </div>
  <!-- HEADER -->
  <div class="header">
    <div class="hLeft">
<img
  src="https://i.imgur.com/ndsvLxn.png"
  alt="Company Logo"
  style="
    width:32px;
    height:32px;
    border-radius:8px;
    display:block;
    object-fit:contain;
    margin-right:12px;
  "
/>
  
      <div class="hTitle">Musely Scheduler</div>
      
      <div class="metaGroup" style="margin-left: 16px;">
        <!-- Agent Profile Pill (agents only - shows PTO and opens profile modal) -->
        <div id="balancePill" class="pill profile-pill" style="display:none;" onclick="openBalanceModal()">
            <span id="balanceText">My Profile</span>
            <span class="profile-pill-badge" id="ptoBadge">0h</span>
        </div>
        <!-- Manager Sign Out Pill (managers only - simple sign out, no modal) -->
        <div id="managerSignOutPill" class="pill sign-out-pill" style="display:none;" onclick="handleLogout()">
            Sign Out
        </div>
        <div id="managerContextPill" class="pill" style="display:none; background:rgba(255,255,255,0.12); color:rgba(255,255,255,0.9); border:none; font-size:11px; font-weight:600; border-radius:20px;">Loading...</div>
      </div>
    </div>
    <div class="hRight">
      <div class="seg">
        <button class="segBtn active" id="btnSchedule" onclick="setView('schedule')">Schedule</button>
        <button class="segBtn" id="btnGoals" onclick="setView('goals')" style="display:none;">Goals</button>
        <button class="segBtn" id="btnMetrics" onclick="setView('metrics')">Metrics</button>
      </div>
<div class="header-divider"></div>
      <!-- Agent Notifications Button (visible for agents) -->
      <button id="btnAgentNotif" class="iconBtn" type="button" title="My Notifications" onclick="openAgentNotifications()" style="position:relative; display:none;">
        <svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/></svg>
        <span id="agentNotifBadge" style="position:absolute; top:-4px; right:-4px; background:#ef4444; color:white; font-size:10px; font-weight:700; min-width:18px; height:18px; border-radius:9px; display:none; align-items:center; justify-content:center;">0</span>
      </button>
      <button id="btnNotif" class="iconBtn" type="button" title="Notifications">
  <svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/></svg>
  <span id="notifCount" class="hidden">0</span>
</button>

<button id="btnAgentToggle" class="btn ghost" style="display:none; font-size:12px; border:1px solid #cbd5e1; margin-right:10px;" onclick="toggleAgentView()">Show Team</button>
      <button id="btnAdmin" type="button" class="iconBtn" title="Admin Settings" onclick="openAdminModal()">
        <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.488.488 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
      </button>
      <button id="btnDarkMode" type="button" class="iconBtn" title="Toggle Dark Mode" onclick="toggleDarkMode()">
        <svg id="darkModeIcon" viewBox="0 0 24 24">
          <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" stroke="currentColor" stroke-width="2" fill="none"/>
        </svg>
      </button>
<button type="button" class="iconBtn" title="Refresh schedule data" onclick="forceRefresh()">
        <svg viewBox="0 0 24 24"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
      </button>
      <!-- View Toggle (Grid/List) -->
      <button type="button" class="iconBtn" id="btnViewToggle" title="Toggle Grid/List View" onclick="toggleShiftView()">
        <svg id="viewToggleIcon" viewBox="0 0 24 24"><path d="M3 3h8v8H3V3zm10 0h8v8h-8V3zM3 13h8v8H3v-8zm10 0h8v8h-8v-8z" fill="currentColor"/></svg>
      </button>
      <!-- Timezone Selector -->
      <div style="position: relative; display: inline-block;">
        <button type="button" class="iconBtn" id="btnTimezone" title="Timezone Settings" onclick="toggleTimezoneDropdown()">
          <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z" fill="currentColor"/></svg>
        </button>
        <div id="timezoneDropdown" style="display: none; position: absolute; right: 0; top: 100%; margin-top: 4px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); padding: 8px; min-width: 200px; z-index: 1000;">
          <div style="font-size: 11px; color: var(--text-secondary); padding: 4px 8px; font-weight: 600; border-bottom: 1px solid var(--border-color); margin-bottom: 6px;">Display Times In:</div>
          <label style="display: flex; align-items: center; gap: 8px; padding: 8px; cursor: pointer; border-radius: 6px; font-size: 13px;" onmouseover="this.style.background='var(--bg-tertiary)'" onmouseout="this.style.background='transparent'">
            <input type="radio" name="timezone" value="PST" checked onchange="setUserTimezone('PST')"> 
            <span>üå¥ Pacific (PST)</span>
          </label>
          <label style="display: flex; align-items: center; gap: 8px; padding: 8px; cursor: pointer; border-radius: 6px; font-size: 13px;" onmouseover="this.style.background='var(--bg-tertiary)'" onmouseout="this.style.background='transparent'">
            <input type="radio" name="timezone" value="MST" onchange="setUserTimezone('MST')"> 
            <span>üèîÔ∏è Mountain (MST)</span>
          </label>
          <label style="display: flex; align-items: center; gap: 8px; padding: 8px; cursor: pointer; border-radius: 6px; font-size: 13px;" onmouseover="this.style.background='var(--bg-tertiary)'" onmouseout="this.style.background='transparent'">
            <input type="radio" name="timezone" value="CST" onchange="setUserTimezone('CST')"> 
            <span>üåΩ Central (CST)</span>
          </label>
          <label style="display: flex; align-items: center; gap: 8px; padding: 8px; cursor: pointer; border-radius: 6px; font-size: 13px;" onmouseover="this.style.background='var(--bg-tertiary)'" onmouseout="this.style.background='transparent'">
            <input type="radio" name="timezone" value="EST" onchange="setUserTimezone('EST')"> 
            <span>üèôÔ∏è Eastern (EST)</span>
          </label>
          <div style="border-top: 1px solid var(--border-color); margin-top: 6px; padding-top: 8px; font-size: 10px; color: var(--text-secondary); text-align: center;">
            ‚ÑπÔ∏è PST always shown in parentheses
          </div>
        </div>
      </div>
      <!-- Google Calendar Export -->
      <button type="button" class="iconBtn" id="btnExportCal" title="Export to Google Calendar" onclick="exportToGoogleCalendar()">
        <svg viewBox="0 0 24 24"><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zm0-12H5V6h14v2zm-2 5h-5v5h5v-5z" fill="currentColor"/></svg>
      </button>
      <button class="iconBtn" id="drawerToggle" title="Tools" onclick="toggleDrawer()">
        <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5v-6h14v6zm0-8H5V5h14v6z"/></svg>
      </button>
      
      <button id="btnMasterMode" class="action-btn" onclick="toggleMasterMode()">Edit Master Schedule</button>
    </div>
  </div>
  <!-- NAV (below header like your UI) -->
  <div class="navGroup">
    <button class="navBtn" onclick="changeDay(-1)">
        <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
    </button>
    <div style="position:relative; overflow:hidden; width:32px; height:32px;">
      <input type="date" id="navDatePicker" style="position:absolute; left:0; top:0; width:100%; height:100%; opacity:0; cursor:pointer;" onchange="handleDateJump(this.value)">
      <button class="navBtn" style="pointer-events:none;">
          <svg viewBox="0 0 24 24"><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zm0-12H5V6h14v2zm-7 5h5v5h-5z"/></svg>
      </button>
    </div>
    <button class="navBtn" onclick="changeDay(1)">
        <svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
    </button>
</div>
<div id="loadMoreControls" class="load-controls">
  <button id="btnLoadPast" class="load-btn" onclick="loadPastSchedule()">
    ‚Üê Load History
  </button>
  <span id="loadedRangeLabel" class="load-label">
    Today ‚Üí 14 days
  </span>
  <button id="btnLoadFuture" class="load-btn" onclick="loadExtendedFuture()">
    Load Future ‚Üí
  </button>
</div>

<!-- AGENT COMPACT SUMMARY BAR -->
<div id="agentCompactBar">
  <div class="compact-summary">
    <div class="summary-card now">
      <div class="summary-icon">üü¢</div>
      <div class="summary-content">
        <div class="summary-label">CURRENT STATUS</div>
        <div class="summary-value" id="summaryNowValue">Off Shift</div>
        <div class="summary-sub" id="summaryNowTeam"></div>
      </div>
    </div>
    <div class="summary-card next">
      <div class="summary-icon">‚è∞</div>
      <div class="summary-content">
        <div class="summary-label">NEXT SHIFT</div>
        <div class="summary-value" id="summaryNextValue">--</div>
        <div class="summary-sub" id="summaryNextDate"></div>
      </div>
    </div>
    <div class="summary-card role" id="summaryRoleCard" style="display:none;">
      <div class="summary-icon">üéØ</div>
      <div class="summary-content">
        <div class="summary-label">YOUR ROLE</div>
        <div class="summary-value" id="summaryRoleValue">--</div>
        <div class="summary-sub" id="summaryRoleDate"></div>
      </div>
    </div>
    <!-- Open Shifts Alert (shows when open shifts available) -->
    <div class="summary-card openshift" id="summaryOpenShiftsCard" style="display:none; cursor: pointer;" onclick="showOpenShiftsPanel()">
      <div class="summary-icon">üîî</div>
      <div class="summary-content">
        <div class="summary-label">OPEN SHIFTS</div>
        <div class="summary-value" id="summaryOpenShiftsCount">0 Available</div>
        <div class="summary-sub" style="color: #dc2626; font-weight: 600;">Click to view</div>
      </div>
    </div>
  </div>
  <div class="compact-actions">
    <div class="compact-tz-wrapper">
      <label class="compact-tz-label">Display Times In:</label>
      <select id="compactTzSelect" class="compact-tz-select" onchange="setUserTimezone(this.value)">
        <option value="PST">Pacific (PST)</option>
        <option value="MST">Mountain (MST)</option>
        <option value="CST">Central (CST)</option>
        <option value="EST">Eastern (EST)</option>
      </select>
    </div>
    <button class="compact-btn secondary" onclick="toggleAgentGoalsPanel()">üéØ My Goals</button>
    <button class="compact-btn secondary" onclick="agentLoadMoreSchedule()">üìÜ Load 30 Days</button>
    <button class="compact-btn secondary" onclick="openSwapShiftModal()">üîÑ Swap Shift</button>
    <button class="compact-btn primary" onclick="openFutureTimeOffModal()">üèñÔ∏è Request Time Off</button>
  </div>
</div>

<!-- Agent Quick Actions -->
<div id="agentQuickActions" class="agent-toolbar">
  <!-- Schedule Range Info -->
  <div class="agent-toolbar-item range-info">
    <span class="toolbar-icon">üìÖ</span>
    <div class="toolbar-text">
      <div class="toolbar-label">Viewing</div>
      <div class="toolbar-value" id="agentRangeLabel">Today ‚Üí 14 days</div>
    </div>
  </div>
  
  <!-- Load More Button for Agents -->
  <button id="btnAgentLoadMore" class="agent-toolbar-btn secondary" onclick="agentLoadMoreSchedule()">
    üìÜ Load 30 Days
  </button>
  
  <!-- Swap Shift -->
  <button class="agent-toolbar-btn secondary" onclick="openSwapShiftModal()">
    üîÑ Swap Shift
  </button>
  
  <!-- My Goals -->
  <button class="agent-toolbar-btn secondary" onclick="toggleAgentGoalsPanel()">
    üéØ My Goals
  </button>
  
  <!-- Future Time Off Request -->
  <button class="agent-toolbar-btn primary" onclick="openFutureTimeOffModal()">
    üèñÔ∏è Request Time Off
  </button>
</div>
<!-- Agent Schedule Banner (Current + Next Shift) -->
<div id="agentScheduleBanner" class="agent-schedule-banner" style="display:none;">
  <div class="agent-schedule-card current">
    <div class="agent-schedule-card-head">
      <span class="agent-schedule-label">Current Shift</span>
      <span class="agent-schedule-pill off" id="agentCurrentShiftStatus">Off</span>
    </div>
    <div class="agent-schedule-time" id="agentCurrentShiftTime">--</div>
    <div class="agent-schedule-meta">
      <span class="agent-schedule-team" id="agentCurrentShiftTeam">--</span>
      <span id="agentCurrentShiftRole"></span>
    </div>
    <div class="agent-schedule-progress" id="agentCurrentShiftProgressWrap">
      <div class="agent-schedule-progress-bar" id="agentCurrentShiftProgress"></div>
    </div>
  </div>
  <div class="agent-schedule-card next">
    <div class="agent-schedule-card-head">
      <span class="agent-schedule-label">Next Shift</span>
      <span class="agent-schedule-pill" id="agentNextShiftStatus">Upcoming</span>
    </div>
    <div class="agent-schedule-time" id="agentNextShiftTime">--</div>
    <div class="agent-schedule-meta">
      <span class="agent-schedule-team" id="agentNextShiftTeam">--</span>
      <span id="agentNextShiftRole"></span>
    </div>
    <div class="agent-schedule-date" id="agentNextShiftDate"></div>
  </div>
</div>

<!-- Agent Assignments Banner (NEW - Shows Meeting Role & Weekly Assignments) -->
<div id="agentAssignmentsBanner" style="display:none; padding: 0 24px; margin-bottom: 16px;">
  <div style="display: flex; gap: 12px; flex-wrap: wrap;">
    <!-- Meeting Role Card -->
    <div id="agentMeetingRoleCard" style="display: none; flex: 1; min-width: 280px; background: var(--bg-secondary); border-radius: 12px; padding: 14px; border: 1px solid var(--border-color); box-shadow: 0 2px 8px var(--shadow-sm);">
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
        <span id="agentMeetingRoleIcon" style="font-size: 20px;">üìÖ</span>
        <div>
          <div id="agentMeetingRoleLabel" style="font-size: 13px; font-weight: 700; color: var(--text-primary);">Meeting Role</div>
          <div id="agentMeetingRoleDate" style="font-size: 11px; color: var(--text-secondary);">Date</div>
        </div>
      </div>
      <div id="agentMeetingRoleDesc" style="font-size: 11px; padding: 8px; background: var(--bg-tertiary); border-radius: 6px; color: var(--text-secondary);"></div>
    </div>
    
    <!-- Weekly Assignments Card -->
    <div id="agentWeeklyAssignCard" style="display: none; flex: 1; min-width: 280px; background: var(--bg-secondary); border-radius: 12px; padding: 14px; border: 1px solid var(--border-color); box-shadow: 0 2px 8px var(--shadow-sm);">
      <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
        <span style="font-size: 20px;">üéØ</span>
        <div>
          <div style="font-size: 13px; font-weight: 700; color: var(--text-primary);">Your Assignments</div>
          <div id="agentWeeklyAssignWeek" style="font-size: 11px; color: var(--text-secondary);">This Week</div>
        </div>
      </div>
      <div id="agentWeeklyAssignList" style="display: flex; flex-wrap: wrap; gap: 6px;"></div>
    </div>
  </div>
</div>
  <!-- MAIN -->
  <div class="main">
    <div class="content">
      <!-- Redesigned Coverage Dashboard (Managers Only) -->
      <div id="coverageDashboard" style="display:none;">
        <div class="cov-panel" id="covPanel">
          <div class="cov-header" onclick="toggleCoverageDashboard()">
            <div class="cov-header-left">
              <div class="cov-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M3 3v18h18"/><path d="M18 17V9"/><path d="M13 17V5"/><path d="M8 17v-3"/>
                </svg>
              </div>
              <div class="cov-title-wrap">
                <h3 class="cov-title">Coverage Today</h3>
                <span class="cov-subtitle" id="covSubtitle">Checking staffing levels...</span>
              </div>
            </div>
            <div class="cov-header-right">
              <span class="cov-badge ok" id="covBadge"><span class="dot"></span><span id="covBadgeText">All Good</span></span>
              <svg class="cov-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"/>
              </svg>
            </div>
          </div>
          <div class="cov-body">
            <div class="cov-content" id="covContent">
              <!-- Content rendered dynamically -->
            </div>
          </div>
        </div>
      </div>
      
      <div id="scheduleView" class="schedule-container">
  <div class="day-tabs" id="dayTabs"></div>
  <div class="day-content">
    <div class="day-content-header">
      <div>
        <h2 id="viewDayTitle" style="margin:0; font-size:20px; font-weight:800;"></h2>
        <div id="viewDayStats" style="font-size:12px; opacity:0.7; margin-top:4px;"></div>
      </div>
    </div>
    <div id="dayContentBody" class="day-content-body">
      <div id="loadingPlaceholder" style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; color:var(--text-secondary);">
        <div class="schedule-loader">
          <div class="loader-spinner"></div>
          <div class="loader-text">Loading your schedule...</div>
          <div class="loader-subtext">Fetching shifts and assignments</div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="masterView" style="display:none; height:100%; overflow-y:auto;"></div>

<!-- ============================================================ -->
<!-- GOALS & ATTENDANCE VIEW ‚Äî MODERNIZED                        -->
<!-- Replaces original lines ~5663-5990 in index.html            -->
<!-- Implements: A1 Tab Shell, A2 Primitives, A3 Overview,       -->
<!--   B2 Goal Cards, C2 Task List, D2 QA+CSAT, D3 Badge,       -->
<!--   E1 Timeline, F1 Meeting Follow-up, F2 Performance Band    -->
<!-- ============================================================ -->

<div id="goalsView" style="display:none; height:100%; flex:1; min-height:0; overflow:hidden;">
  <div class="goals-container">

    <!-- Left Sidebar: Agent List -->
    <div class="goals-sidebar">
      <div class="goals-sidebar-header">
        <div class="goals-sidebar-title">Team Members</div>
        <input type="text" id="goalsAgentSearch" class="goals-search" placeholder="Search agent..." oninput="filterGoalsAgentList()">
      </div>
      <div id="goalsAgentList" class="goals-agent-list">
        <!-- Populated by JS -->
      </div>
    </div>

    <!-- Right Panel: Goals Detail -->
    <div class="goals-main">
      <div id="goalsPlaceholder" class="goals-placeholder">
        <div style="font-size: 48px;">üéØ</div>
        <div style="font-size: 16px; font-weight: 600; margin-top: 12px;">Select a Team Member</div>
        <div style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">Choose a team member from the list to view and edit their goals, attendance, and performance tracking.</div>
      </div>

      <div id="goalsContent" class="goals-content" style="display:none;">

        <!-- ‚îÄ‚îÄ Agent Header (consistent across all tabs) ‚îÄ‚îÄ -->
        <div class="goals-agent-header">
          <div class="goals-agent-info">
            <div class="goals-agent-name" id="goalsAgentName">Agent Name</div>
            <div class="goals-agent-meta" id="goalsAgentMeta">Last updated: Never</div>
          </div>
          <div class="goals-agent-actions">
            <button class="btn primary" onclick="saveAgentGoals()">üíæ Save Changes</button>
          </div>
        </div>

        <!-- ‚îÄ‚îÄ Tab Bar (with badge support) ‚îÄ‚îÄ -->
        <div class="goals-tabs">
          <button class="goals-tab active" data-tab="overview" onclick="switchGoalsTab('overview')">üìã Overview</button>
          <button class="goals-tab" data-tab="smart" onclick="switchGoalsTab('smart')">üéØ Goals</button>
          <button class="goals-tab" data-tab="tasks" onclick="switchGoalsTab('tasks')">üìå Tasks</button>
          <button class="goals-tab" data-tab="attendance" onclick="switchGoalsTab('attendance')">üìÖ Attendance</button>
          <button class="goals-tab" data-tab="metrics" onclick="switchGoalsTab('metrics')">üìä Performance</button>
          <button class="goals-tab" data-tab="qa" onclick="switchGoalsTab('qa')">
            ‚úÖ QA
            <span class="goals-tab-badge" id="qaTabBadge" style="display:none;">0</span>
          </button>
          <button class="goals-tab" data-tab="topics" onclick="switchGoalsTab('topics')">üí¨ Topics</button>
          <button class="goals-tab" data-tab="notes" onclick="switchGoalsTab('notes')">üìù 1:1 Notes</button>
        </div>

        <!-- ‚îÄ‚îÄ Tab Content Area ‚îÄ‚îÄ -->
        <div class="goals-tab-content">

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- OVERVIEW TAB (A3 ‚Äî read-only summary v1)   -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <div id="tabOverview" class="goals-tab-pane active">
            <div class="overview-grid" id="overviewGrid">
              <!-- Goals summary card -->
              <div class="overview-card">
                <div class="overview-card-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">üéØ</div>
                <div class="overview-card-body">
                  <div class="overview-card-label">Active Goals</div>
                  <div class="overview-card-value" id="ovGoalsActive">0</div>
                  <div class="overview-card-sub" id="ovGoalsDue">No goals due soon</div>
                </div>
              </div>
              <!-- Tasks summary card -->
              <div class="overview-card">
                <div class="overview-card-icon" style="background: linear-gradient(135deg, #3b82f6, #2563eb);">üìå</div>
                <div class="overview-card-body">
                  <div class="overview-card-label">Tasks</div>
                  <div class="overview-card-value" id="ovTasksOpen">0</div>
                  <div class="overview-card-sub" id="ovTasksOverdue">0 overdue</div>
                </div>
              </div>
              <!-- QA summary card -->
              <div class="overview-card">
                <div class="overview-card-icon" style="background: linear-gradient(135deg, #10b981, #059669);">‚úÖ</div>
                <div class="overview-card-body">
                  <div class="overview-card-label">QA Reviews</div>
                  <div class="overview-card-value" id="ovQaCount">0</div>
                  <div class="overview-card-sub" id="ovQaPending">0 pending review</div>
                </div>
              </div>
              <!-- CSAT Follow-ups card -->
              <div class="overview-card">
                <div class="overview-card-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);">‚ö†Ô∏è</div>
                <div class="overview-card-body">
                  <div class="overview-card-label">CSAT Follow-ups</div>
                  <div class="overview-card-value" id="ovCsatPending">0</div>
                  <div class="overview-card-sub" id="ovCsatSub">needing follow-up</div>
                </div>
              </div>
              <!-- Attendance card -->
              <div class="overview-card">
                <div class="overview-card-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">üìÖ</div>
                <div class="overview-card-body">
                  <div class="overview-card-label">Attendance</div>
                  <div class="overview-card-value" id="ovBradford">0</div>
                  <div class="overview-card-sub" id="ovBradfordLabel">Bradford Factor</div>
                </div>
              </div>
              <!-- Performance card -->
              <div class="overview-card">
                <div class="overview-card-icon" style="background: linear-gradient(135deg, #ec4899, #db2777);">üìä</div>
                <div class="overview-card-body">
                  <div class="overview-card-label">Performance</div>
                  <div class="overview-card-value" id="ovPerfWeeks">0</div>
                  <div class="overview-card-sub" id="ovPerfSub">weeks tracked</div>
                </div>
              </div>
            </div>

            <!-- Quick action items -->
            <div class="overview-actions" id="overviewActions">
              <!-- Populated by JS with attention items -->
            </div>
          </div>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- S.M.A.R.T. GOALS TAB (B2 ‚Äî cards + editor) -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <div id="tabSmart" class="goals-tab-pane">
            <!-- Section Header -->
            <div class="section-header-bar">
              <div class="section-header-left">
                <span class="section-header-title">üéØ S.M.A.R.T. Goals</span>
                <span class="section-header-hint">Specific, Measurable, Attainable, Relevant, Time-bound</span>
              </div>
              <div class="section-header-right">
                <button class="btn-modern primary-sm" onclick="openGoalEditor()">+ Add Goal</button>
              </div>
            </div>

            <!-- Goal Cards List -->
            <div id="smartGoalsList" class="smart-goals-list">
              <!-- Populated by JS ‚Äî each goal is a card -->
              <!-- Empty state rendered dynamically -->
            </div>

            <!-- Goal Editor Drawer (hidden by default) -->
            <div id="goalEditorDrawer" class="goal-editor-drawer" style="display:none;">
              <div class="goal-editor-header">
                <span class="goal-editor-title" id="goalEditorTitle">New Goal</span>
                <button class="btn-modern ghost-sm" onclick="closeGoalEditor()">‚úï</button>
              </div>
              <div class="goal-editor-body">
                <input type="hidden" id="goalEditorId" value="">
                <div class="goal-editor-field">
                  <label>Goal Title</label>
                  <input type="text" id="goalEditorTitleInput" placeholder="e.g. Improve first-response time to under 2 minutes" class="modern-input">
                </div>
                <div class="goal-editor-row">
                  <div class="goal-editor-field">
                    <label>Status</label>
                    <select id="goalEditorStatus" class="modern-select">
                      <option value="draft">üìù Draft</option>
                      <option value="active" selected>üü¢ Active</option>
                      <option value="at_risk">üü° At Risk</option>
                      <option value="complete">‚úÖ Complete</option>
                      <option value="archived">üì¶ Archived</option>
                    </select>
                  </div>
                  <div class="goal-editor-field">
                    <label>Due Date</label>
                    <input type="date" id="goalEditorDue" class="modern-input">
                  </div>
                </div>
                <div class="goal-editor-row">
                  <div class="goal-editor-field">
                    <label>Review Cadence</label>
                    <select id="goalEditorCadence" class="modern-select">
                      <option value="">None</option>
                      <option value="weekly">Weekly</option>
                      <option value="biweekly">Biweekly</option>
                      <option value="monthly">Monthly</option>
                    </select>
                  </div>
                  <div class="goal-editor-field">
                    <label>Next Check-in</label>
                    <input type="date" id="goalEditorNextCheckin" class="modern-input">
                  </div>
                </div>
                <div class="goal-editor-smart-fields">
                  <div class="goal-editor-field">
                    <label><span class="smart-label">S</span> Specific</label>
                    <textarea id="goalEditorSpecific" class="modern-textarea" placeholder="Clearly define what success looks like and who's involved."></textarea>
                  </div>
                  <div class="goal-editor-field">
                    <label><span class="smart-label">M</span> Measurable</label>
                    <textarea id="goalEditorMeasurable" class="modern-textarea" placeholder="Determine how progress will be tracked or proven."></textarea>
                  </div>
                  <div class="goal-editor-field">
                    <label><span class="smart-label">A</span> Attainable</label>
                    <textarea id="goalEditorAttainable" class="modern-textarea" placeholder="Ensure the goal is realistic given time, workload and tools."></textarea>
                  </div>
                  <div class="goal-editor-field">
                    <label><span class="smart-label">R</span> Relevant</label>
                    <textarea id="goalEditorRelevant" class="modern-textarea" placeholder="Aligns with your current role, responsibilities, and priorities."></textarea>
                  </div>
                  <div class="goal-editor-field">
                    <label><span class="smart-label">T</span> Time Bound</label>
                    <textarea id="goalEditorTimeBound" class="modern-textarea" placeholder="Give the goal a realistic but motivating deadline."></textarea>
                  </div>
                </div>
              </div>
              <div class="goal-editor-footer">
                <button class="btn-modern ghost-sm" onclick="closeGoalEditor()">Cancel</button>
                <button class="btn-modern danger-sm" id="goalEditorDeleteBtn" onclick="deleteCurrentGoal()" style="display:none;">üóë Delete</button>
                <button class="btn-modern primary-sm" onclick="saveGoalFromEditor()">üíæ Save Goal</button>
              </div>
            </div>
          </div>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- TASKS TAB (C2 ‚Äî task list with filters)     -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <div id="tabTasks" class="goals-tab-pane">
            <div class="section-header-bar">
              <div class="section-header-left">
                <span class="section-header-title">üìå Tasks & Projects</span>
              </div>
              <div class="section-header-right">
                <button class="btn-modern primary-sm" onclick="openTaskEditor()">+ Add Task</button>
              </div>
            </div>

            <!-- Filter Chips -->
            <div class="filter-chips" id="taskFilterChips">
              <button class="filter-chip active" data-filter="all" onclick="filterTasks('all')">All</button>
              <button class="filter-chip" data-filter="overdue" onclick="filterTasks('overdue')">üî¥ Overdue</button>
              <button class="filter-chip" data-filter="due_soon" onclick="filterTasks('due_soon')">üü° Due Soon</button>
              <button class="filter-chip" data-filter="in_progress" onclick="filterTasks('in_progress')">üîÑ In Progress</button>
              <button class="filter-chip" data-filter="done" onclick="filterTasks('done')">‚úÖ Completed</button>
            </div>

            <!-- Task List -->
            <div id="tasksList" class="tasks-list">
              <!-- Empty state rendered dynamically -->
            </div>

            <!-- Task Editor (inline expandable) -->
            <div id="taskEditorPanel" class="task-editor-panel" style="display:none;">
              <input type="hidden" id="taskEditorId" value="">
              <div class="task-editor-grid">
                <div class="goal-editor-field" style="grid-column: 1 / -1;">
                  <label>Task Title</label>
                  <input type="text" id="taskEditorTitle" class="modern-input" placeholder="What needs to be done?">
                </div>
                <div class="goal-editor-field">
                  <label>Priority</label>
                  <select id="taskEditorPriority" class="modern-select">
                    <option value="">Select</option>
                    <option value="high">üî¥ High</option>
                    <option value="medium">üü° Medium</option>
                    <option value="low">üü¢ Low</option>
                  </select>
                </div>
                <div class="goal-editor-field">
                  <label>Due Date</label>
                  <input type="date" id="taskEditorDue" class="modern-input">
                </div>
                <div class="goal-editor-field">
                  <label>Status</label>
                  <select id="taskEditorStatus" class="modern-select">
                    <option value="open">Open</option>
                    <option value="in_progress">In Progress</option>
                    <option value="done">Completed</option>
                    <option value="blocked">Blocked</option>
                  </select>
                </div>
                <div class="goal-editor-field" style="grid-column: 1 / -1;">
                  <label>Notes</label>
                  <textarea id="taskEditorNotes" class="modern-textarea" placeholder="Additional details..."></textarea>
                </div>
              </div>
              <div class="task-editor-actions">
                <button class="btn-modern ghost-sm" onclick="closeTaskEditor()">Cancel</button>
                <button class="btn-modern danger-sm" id="taskEditorDeleteBtn" onclick="deleteCurrentTask()" style="display:none;">üóë Delete</button>
                <button class="btn-modern primary-sm" onclick="saveTaskFromEditor()">Save Task</button>
              </div>
            </div>
          </div>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- ATTENDANCE TAB (E1 timeline + F1 meeting)   -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <div id="tabAttendance" class="goals-tab-pane">
            <div class="section-header-bar">
              <div class="section-header-left">
                <span class="section-header-title">üìÖ Attendance Summary</span>
              </div>
              <div class="section-header-right">
                <select id="attendancePeriod" onchange="loadAgentAttendance()" class="modern-select" style="width: auto;">
                  <option value="7">Last 7 Days</option>
                  <option value="30">Last 30 Days</option>
                  <option value="60">Last 60 Days</option>
                  <option value="90" selected>Last 90 Days</option>
                  <option value="180">Last 6 Months</option>
                  <option value="365">Last Year</option>
                </select>
              </div>
            </div>

            <!-- Summary Band -->
            <div class="summary-band">
              <div class="summary-card bradford">
                <div class="summary-card-label">Bradford Factor</div>
                <div class="summary-card-value" id="attBradford">--</div>
                <div class="summary-card-status" id="attBradfordStatus">Calculating...</div>
              </div>
              <div class="summary-card">
                <div class="summary-card-label">Call Outs</div>
                <div class="summary-card-value" id="attCallOuts">--</div>
              </div>
              <div class="summary-card">
                <div class="summary-card-label">PTO Requests</div>
                <div class="summary-card-value" id="attPTO">--</div>
              </div>
              <div class="summary-card">
                <div class="summary-card-label">Swaps Initiated</div>
                <div class="summary-card-value" id="attSwapsInit">--</div>
              </div>
              <div class="summary-card">
                <div class="summary-card-label">Times Replaced</div>
                <div class="summary-card-value" id="attReplaced">--</div>
              </div>
              <div class="summary-card">
                <div class="summary-card-label">Covered Others</div>
                <div class="summary-card-value" id="attCovered">--</div>
              </div>
            </div>

            <!-- Meeting Follow-up Action Area (F1) -->
            <div class="section-header-bar" style="margin-top: 24px;">
              <div class="section-header-left">
                <span class="section-header-title">üìû Meeting Follow-ups</span>
              </div>
              <div class="section-header-right">
                <button class="btn-modern primary-sm" onclick="addMeetingFollowup()">+ Log Follow-up</button>
              </div>
            </div>
            <div id="meetingFollowups" class="meeting-followups-list">
              <!-- Populated by JS -->
            </div>

            <!-- Timeline (E1 ‚Äî unified timeline component) -->
            <div class="section-header-bar" style="margin-top: 24px;">
              <div class="section-header-left">
                <span class="section-header-title">üìú Event History</span>
              </div>
              <div class="section-header-right">
                <div class="filter-chips compact">
                  <button class="filter-chip active" data-filter="all" onclick="filterTimeline('all', 'attendance')">All</button>
                  <button class="filter-chip" data-filter="timeoff" onclick="filterTimeline('timeoff', 'attendance')">PTO</button>
                  <button class="filter-chip" data-filter="swap" onclick="filterTimeline('swap', 'attendance')">Swaps</button>
                  <button class="filter-chip" data-filter="callout" onclick="filterTimeline('callout', 'attendance')">Call Outs</button>
                </div>
              </div>
            </div>
            <div class="timeline" id="attendanceTimeline">
              <div class="timeline-loading">Loading attendance data...</div>
            </div>
          </div>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- PERFORMANCE TAB (F2 ‚Äî summary band + list)  -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <div id="tabMetrics" class="goals-tab-pane">
            <div class="section-header-bar">
              <div class="section-header-left">
                <span class="section-header-title">üìä Weekly Performance Metrics</span>
              </div>
              <div class="section-header-right">
                <button class="btn-modern primary-sm" onclick="addMetricsRow()">+ Add Week</button>
              </div>
            </div>

            <!-- Performance Summary Band (F2) -->
            <div class="summary-band" id="perfSummaryBand">
              <div class="summary-card">
                <div class="summary-card-label">Avg Tickets/Week</div>
                <div class="summary-card-value" id="perfAvgTickets">--</div>
              </div>
              <div class="summary-card">
                <div class="summary-card-label">Avg CSAT</div>
                <div class="summary-card-value" id="perfAvgCsat">--</div>
              </div>
              <div class="summary-card">
                <div class="summary-card-label">This Week vs Prior</div>
                <div class="summary-card-value" id="perfTrend">--</div>
              </div>
              <div class="summary-card">
                <div class="summary-card-label">Total Call Outs</div>
                <div class="summary-card-value" id="perfTotalCallOuts">--</div>
              </div>
            </div>

            <div class="goals-table-wrap">
              <table class="goals-table" id="metricsTable">
                <thead>
                  <tr>
                    <th style="width:14%">Week Starting</th>
                    <th style="width:10%">Tickets Solved</th>
                    <th style="width:10%">CSAT %</th>
                    <th style="width:20%">Wins / Challenges</th>
                    <th style="width:10%">Call Outs</th>
                    <th style="width:12%">Make Up Hours</th>
                    <th style="width:18%">Notes</th>
                    <th style="width:6%"></th>
                  </tr>
                </thead>
                <tbody id="metricsTableBody">
                  <!-- Rows added by JS -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- QA TAB (D2 ‚Äî two sections + D3 badge)       -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <div id="tabQa" class="goals-tab-pane">

            <!-- Section 1: QA Reviews (existing, modernized) -->
            <div class="section-header-bar">
              <div class="section-header-left">
                <span class="section-header-title">‚úÖ QA Reviews</span>
              </div>
              <div class="section-header-right">
                <button class="btn-modern primary-sm" onclick="addQaRow()">+ Add QA Review</button>
              </div>
            </div>
            <div class="goals-table-wrap">
              <table class="goals-table" id="qaTable">
                <thead>
                  <tr>
                    <th style="width:12%">Date</th>
                    <th style="width:12%">Channel</th>
                    <th style="width:12%">Ticket #</th>
                    <th style="width:25%">Notes</th>
                    <th style="width:10%">Gone Over?</th>
                    <th style="width:23%">Follow-up Notes</th>
                    <th style="width:6%"></th>
                  </tr>
                </thead>
                <tbody id="qaTableBody">
                  <!-- Rows added by JS -->
                </tbody>
              </table>
            </div>

            <!-- Section 2: Low CSAT Follow-ups (D1/D2 ‚Äî new) -->
            <div class="section-header-bar" style="margin-top: 32px;">
              <div class="section-header-left">
                <span class="section-header-title">‚ö†Ô∏è Low CSAT Follow-ups</span>
                <span class="csat-pending-count" id="csatPendingCount" style="display:none;">0 pending</span>
              </div>
              <div class="section-header-right">
                <button class="btn-modern primary-sm" onclick="openCsatFollowupEditor()">+ Add Follow-up</button>
              </div>
            </div>

            <!-- CSAT Filter -->
            <div class="filter-chips" id="csatFilterChips">
              <button class="filter-chip active" data-filter="all" onclick="filterCsatFollowups('all')">All</button>
              <button class="filter-chip" data-filter="pending" onclick="filterCsatFollowups('pending')">‚è≥ Needs Follow-up</button>
              <button class="filter-chip" data-filter="completed" onclick="filterCsatFollowups('completed')">‚úÖ Completed</button>
            </div>

            <!-- CSAT Follow-ups List -->
            <div id="csatFollowupsList" class="csat-followups-list">
              <!-- Empty state rendered dynamically -->
            </div>

            <!-- CSAT Follow-up Editor (inline panel) -->
            <div id="csatEditorPanel" class="csat-editor-panel" style="display:none;">
              <input type="hidden" id="csatEditorId" value="">
              <div class="task-editor-grid">
                <div class="goal-editor-field">
                  <label>Date Received</label>
                  <input type="date" id="csatEditorDate" class="modern-input">
                </div>
                <div class="goal-editor-field">
                  <label>Ticket Number</label>
                  <input type="text" id="csatEditorTicket" class="modern-input" placeholder="#12345">
                </div>
                <div class="goal-editor-field">
                  <label>Channel</label>
                  <select id="csatEditorChannel" class="modern-select">
                    <option value="">Select</option>
                    <option value="Live Chat">Live Chat</option>
                    <option value="Phone">Phone</option>
                    <option value="Email">Email</option>
                    <option value="Socials">Socials</option>
                  </select>
                </div>
                <div class="goal-editor-field">
                  <label>Rating</label>
                  <select id="csatEditorRating" class="modern-select">
                    <option value="">Select</option>
                    <option value="1">‚≠ê 1 ‚Äî Very Poor</option>
                    <option value="2">‚≠ê‚≠ê 2 ‚Äî Poor</option>
                    <option value="3">‚≠ê‚≠ê‚≠ê 3 ‚Äî Below Average</option>
                  </select>
                </div>
                <div class="goal-editor-field" style="grid-column: 1 / -1;">
                  <label>Issue Summary</label>
                  <textarea id="csatEditorSummary" class="modern-textarea" placeholder="Brief summary of the customer issue..."></textarea>
                </div>
                <div class="goal-editor-field">
                  <label>Follow-up Method</label>
                  <select id="csatEditorMethod" class="modern-select">
                    <option value="">Select</option>
                    <option value="email">üìß Email</option>
                    <option value="chat">üí¨ Chat</option>
                    <option value="phone">üìû Phone</option>
                  </select>
                </div>
                <div class="goal-editor-field">
                  <label>
                    <input type="checkbox" id="csatEditorCompleted" onchange="toggleCsatCompletedDate()">
                    Patient Contacted / Completed
                  </label>
                  <input type="date" id="csatEditorCompletedAt" class="modern-input" style="display:none;">
                </div>
                <div class="goal-editor-field" style="grid-column: 1 / -1;">
                  <label>Notes</label>
                  <textarea id="csatEditorNotes" class="modern-textarea" placeholder="Follow-up notes..."></textarea>
                </div>
              </div>
              <div class="task-editor-actions">
                <button class="btn-modern ghost-sm" onclick="closeCsatEditor()">Cancel</button>
                <button class="btn-modern danger-sm" id="csatEditorDeleteBtn" onclick="deleteCurrentCsatFollowup()" style="display:none;">üóë Delete</button>
                <button class="btn-modern primary-sm" onclick="saveCsatFollowupFromEditor()">Save Follow-up</button>
              </div>
            </div>
          </div>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- TOPICS TAB (unchanged structure, cleaner)   -->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <div id="tabTopics" class="goals-tab-pane">
            <div class="section-header-bar">
              <div class="section-header-left">
                <span class="section-header-title">üí¨ Topics Discussed</span>
              </div>
              <div class="section-header-right">
                <button class="btn-modern primary-sm" onclick="addTopicRow()">+ Add Topic</button>
              </div>
            </div>
            <div class="goals-table-wrap">
              <table class="goals-table" id="topicsTable">
                <thead>
                  <tr>
                    <th style="width:12%">Date</th>
                    <th style="width:22%">Topic Discussed</th>
                    <th style="width:22%">Their Thoughts</th>
                    <th style="width:12%">Follow-up?</th>
                    <th style="width:26%">Notes</th>
                    <th style="width:6%"></th>
                  </tr>
                </thead>
                <tbody id="topicsTableBody">
                  <!-- Rows added by JS -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <!-- 1:1 NOTES TAB (unchanged structure, cleaner)-->
          <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
          <div id="tabNotes" class="goals-tab-pane">
            <div class="section-header-bar">
              <div class="section-header-left">
                <span class="section-header-title">üìù 1:1 Notes + Questions Monthly</span>
              </div>
              <div class="section-header-right">
                <button class="btn-modern primary-sm" onclick="addNoteRow()">+ Add Entry</button>
              </div>
            </div>
            <div class="goals-table-wrap">
              <table class="goals-table" id="notesTable">
                <thead>
                  <tr>
                    <th style="width:12%">Date</th>
                    <th style="width:22%">Question Asked</th>
                    <th style="width:22%">Their Answer</th>
                    <th style="width:12%">Follow-up?</th>
                    <th style="width:26%">Notes</th>
                    <th style="width:6%"></th>
                  </tr>
                </thead>
                <tbody id="notesTableBody">
                  <!-- Rows added by JS -->
                </tbody>
              </table>
            </div>
          </div>

        </div><!-- /goals-tab-content -->
      </div><!-- /goalsContent -->
    </div><!-- /goals-main -->
  </div><!-- /goals-container -->
</div><!-- /goalsView -->


<!-- Agent Goals Modal (read-only view for agents) -->
<div id="agentGoalsModal" class="overlay" style="display:none;" onclick="if(event.target===this) closeAgentGoalsModal()">
  <div class="modal" style="width: 700px; max-height: 90vh; display: flex; flex-direction: column;">
    <div class="mHead" style="background: linear-gradient(135deg, #b37e78 0%, #8f5f5a 100%); border-bottom: none; flex-shrink: 0;">
      <span class="mTitle" style="color: white;">üìã My Goals & Progress</span>
      <button type="button" class="btn ghost" style="padding:6px 12px; color:white; background:rgba(255,255,255,0.15); border:1px solid rgba(255,255,255,0.25);" onclick="closeAgentGoalsModal()">‚úï</button>
    </div>
    <div class="mBody" style="flex: 1; overflow-y: auto; max-height: calc(90vh - 60px); padding: 20px;">
      <div class="agent-goals-meta" id="agentGoalsMeta" style="font-size: 12px; color: var(--text-tertiary); margin-bottom: 16px;">Last updated: Never</div>
      <div id="agentGoalsContent">
        <div class="attendance-loading">Loading your goals...</div>
      </div>
    </div>
  </div>
</div>

<div id="agentGoalsView" style="display:none; height:100%; flex:1; min-height:0; overflow:auto; padding: 24px;">
  <div class="agent-goals-container">
    <div class="agent-goals-header">
      <h2>üìã My Goals & Progress</h2>
      <div class="agent-goals-meta" id="agentGoalsMetaAlt">Last updated: Never</div>
    </div>
    <div id="agentGoalsContentAlt">
      <!-- Populated by JS -->
    </div>
  </div>
</div>




      <div id="metricsView" style="display:none; height:100%; flex:1; min-height:0; overflow:hidden;">
        <div class="metricsWrap" style="height:100%;">
          <div class="metricsLeft">
            <div class="metricsTop">
              <div class="metricsTitleWrap">
  <div class="metricsTitle">Agent Metrics</div>
  <div id="metricsCount" class="metricsCount"></div>
</div>
              <input id="metricsSearch" class="qrSearch" placeholder="Search agent..." oninput="renderMetricsList()" />
            </div>
            <div id="metricsList" class="metricsList"></div>
          </div>
          <div id="metricsDrawer" class="metricsDrawer">
            <div class="metricsDrawerHead">
              <div style="font-weight:800;">Profile</div>
              <button type="button" class="btn ghost" style="padding:6px 10px;" onclick="closeMetricsDrawer()">‚úï</button>
            </div>
            <div class="metricsDrawerBody">
              <div id="mProfLoader" style="color:#64748b; font-size:13px; padding:10px 0;">Select an agent to load metrics.</div>
              <div id="mProfContent" style="display:none; text-align:center;">
                <img id="mAvatar" src="" style="width:72px; height:72px; border-radius:50%; background:#e2e8f0; margin:10px auto 10px; border:3px solid #fff; box-shadow:0 4px 6px rgba(0,0,0,0.1);">
                <div id="mName" style="font-size:18px; font-weight:900; color:#0f172a;"></div>
                <div id="mEmail" style="font-size:12px; color:#64748b; margin-bottom:14px;"></div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px; text-align:left; margin: 0 auto; max-width: 360px;">
                  <div style="background:#f0f9ff; padding:10px; border-radius:8px; border:1px solid #bae6fd;">
                    <div style="font-size:10px; font-weight:800; color:#0369a1;">OPEN TICKETS</div>
                    <div id="mOpen" style="font-size:18px; font-weight:900; color:#0284c7;">--</div>
                  </div>
                  <div style="background:#fdf2f8; padding:10px; border-radius:8px; border:1px solid #fbcfe8;">
                    <div style="font-size:10px; font-weight:800; color:#be185d;">ROLE</div>
                    <div id="mRole" style="font-size:14px; font-weight:800; color:#db2777;">--</div>
                  </div>
                </div>
                <!-- Clickable ticket list for managers -->
                <div id="mTicketsList" style="margin:12px auto 0; max-width: 360px; max-height: 180px; overflow-y: auto; display: none;">
                  <!-- Populated by JS -->
                </div>
                <div id="mTicketsEmpty" style="margin:8px auto 0; max-width: 360px; text-align: center; color: var(--text-tertiary); font-size: 12px; display: none;">
                  üéâ No open tickets!
                </div>
                <div style="margin:10px auto 0; max-width: 360px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; font-size: 11px; color: var(--text-secondary); text-align: center;">
                  üí° For CSAT &amp; Solved metrics, view <a href="https://musely.zendesk.com/explore" target="_blank" style="color: var(--accent-primary);">Zendesk Explore</a>
                </div>
                <div style="margin:10px auto 0; max-width: 360px; text-align:left;">
                  <div style="font-size:11px; color:#94a3b8;">Last Login: <span id="mLogin">--</span></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Old skeleton view - replaced with inline loading spinner -->
      <div id="skeletonView" class="skel-wrapper" style="display:none !important;">
        <div class="skel-col"><div class="skel-anim skel-head"></div><div class="skel-anim skel-card"></div><div class="skel-anim skel-card"></div></div>
        <div class="skel-col"><div class="skel-anim skel-head"></div><div class="skel-anim skel-card"></div><div class="skel-anim skel-card"></div></div>
        <div class="skel-col"><div class="skel-anim skel-head"></div><div class="skel-anim skel-card"></div><div class="skel-anim skel-card"></div></div>
        <div class="skel-col"><div class="skel-anim skel-head"></div><div class="skel-anim skel-card"></div><div class="skel-anim skel-card"></div></div>
      </div>
    </div>
    <!-- RIGHT DRAWER -->
    <div id="rightDrawer" class="drawer">
      <div class="drawerHead" style="height: auto; flex-direction: column; gap: 10px; padding-bottom: 15px;">
        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
          <span>Tools</span>
          <div class="seg">
            <button class="segBtn active" id="btnModeQuick" onclick="setMode('quick')">Quick</button>
            <button class="segBtn" id="btnModeTeam" onclick="setMode('team')">Channel</button>
          </div>
        </div>
      </div>
      <div class="drawerBody" id="drawerQuick">
        <div class="filter-card">
          <div class="filter-header">‚ö° Quick Filters</div>
          <div style="display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn-pill" onclick="filterToday()">Today</button>
            <button class="btn-pill" style="background:#fef2f2; color:#ef4444;" onclick="resetAllFilters()">Reset</button>
          </div>
        </div>
        <div class="filter-card" style="border-left: 4px solid #b37e78;">
          <div class="filter-header">üë• Channel View</div>
          <select id="teamDropdown" onchange="updateTeamAgentList()" style="width:100%; padding:8px; border-radius:6px; border:1px solid #cbd5e1; margin-bottom:12px;">
            <option value="">Select Team...</option>
          </select>
          <div id="teamAgentList" style="display:flex; gap:6px; flex-wrap:wrap;"></div>
        </div>
        <div style="margin-top:20px; border-top:1px solid #f1f5f9; padding-top:16px;">
          <label style="font-size:11px; color:#94a3b8; font-weight:700;">SEARCH ALL PEOPLE</label>
          <input class="qrSearch" id="qrSearch" placeholder="Search name..." oninput="renderQuickRail()" />
          <div id="qrList" style="display:flex; flex-direction:column; gap:6px;"></div>
        </div>
      </div>
      <div class="drawerBody hidden" id="drawerTeam">
        <p style="font-size:13px; color:#64748b; margin-bottom:16px;">Select shifts in the calendar, then apply bulk changes.</p>
        <div style="margin-bottom:8px; font-size:12px; font-weight:700; color:#0f172a;">SELECTED: <span id="tpCount" style="color:#b37e78;">0</span></div>
        <div style="margin-bottom:16px;">
          <label>Assign To</label>
          <select id="tpPerson"></select>
        </div>
        <button class="btn primary" style="width:100%;" onclick="applyBatch()">Apply Changes</button>
        <button class="btn ghost" style="width:100%; margin-top:12px;" onclick="clearTeamSelection()">Clear Selection</button>
      </div>
    </div>
  </div>
  <!-- SELECTION BAR -->
  <div id="selectionBar" class="selection-bar">
    <div class="sb-left">
      <div class="sb-count"><span id="sbCount">0</span> selected</div>
      <div style="height: 20px; width: 1px; background: rgba(255,255,255,0.2);"></div>
      <button class="sb-btn" id="btnSelectSimilar" onclick="selectSimilarVisible()">Select All Visible for this Person</button>
    </div>
    <div class="sb-actions">
      <button class="sb-btn" onclick="clearTeamSelection()">Cancel</button>
      <button class="sb-btn primary" onclick="openBatchEditModal()">Edit / Move</button>
      <button class="sb-btn danger" onclick="batchMarkOff()">Mark OFF</button>
    </div>
  </div>
  <!-- EDIT SHIFT MODAL -->
  <div id="editShiftModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
    <div class="edit-shift-modal-content" style="background:var(--card-bg, white); padding:24px; border-radius:12px; width:320px; box-shadow:0 25px 50px -12px rgba(0,0,0,0.25); border:1px solid var(--border-color, #e2e8f0);">
      <h3 style="margin:0 0 20px 0; color:var(--text-primary, #0f172a); font-size:18px; font-weight:700;">Edit Shift</h3>
      <div style="margin-bottom:16px;">
        <label style="display:block; font-size:11px; font-weight:600; color:var(--text-secondary, #64748b); margin-bottom:6px; text-transform:uppercase;">Employee</label>
        <input type="text" id="modalEmployee" disabled style="width:100%; padding:10px 12px; border:1px solid var(--border-color, #e2e8f0); background:var(--bg-tertiary, #f8fafc); border-radius:8px; color:var(--text-secondary, #64748b); font-size:14px; box-sizing:border-box;">
      </div>
      <div style="margin-bottom:16px;">
        <label style="display:block; font-size:11px; font-weight:600; color:var(--text-secondary, #64748b); margin-bottom:6px; text-transform:uppercase;">Day</label>
        <input type="text" id="modalDay" disabled style="width:100%; padding:10px 12px; border:1px solid var(--border-color, #e2e8f0); background:var(--bg-tertiary, #f8fafc); border-radius:8px; color:var(--text-secondary, #64748b); font-size:14px; box-sizing:border-box;">
      </div>
      <div style="display:flex; gap:12px; margin-bottom:16px;">
        <div style="flex:1;">
          <label style="display:block; font-size:11px; font-weight:600; color:var(--text-secondary, #64748b); margin-bottom:6px; text-transform:uppercase;">Start</label>
          <input type="time" id="modalStart" style="width:100%; padding:10px 12px; border:1px solid var(--border-color, #e2e8f0); border-radius:8px; background:var(--card-bg, #fff); color:var(--text-primary, #0f172a); font-size:14px; box-sizing:border-box;">
        </div>
        <div style="flex:1;">
          <label style="display:block; font-size:11px; font-weight:600; color:var(--text-secondary, #64748b); margin-bottom:6px; text-transform:uppercase;">End</label>
          <input type="time" id="modalEnd" style="width:100%; padding:10px 12px; border:1px solid var(--border-color, #e2e8f0); border-radius:8px; background:var(--card-bg, #fff); color:var(--text-primary, #0f172a); font-size:14px; box-sizing:border-box;">
        </div>
      </div>
      <input type="hidden" id="modalOrigStart">
      <input type="hidden" id="modalOrigEnd">
      <input type="hidden" id="modalOrigTeam">
      <input type="hidden" id="modalOrigRole">
      <input type="hidden" id="modalDocId">
      <input type="hidden" id="modalAssignmentId">
      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:16px;">
        <div>
          <label style="display:block; font-size:11px; font-weight:600; color:var(--text-secondary, #64748b); margin-bottom:6px; text-transform:uppercase;">Channel</label>
          <select id="modalTeam" onchange="toggleCustomChannel(this)" style="width:100%; padding:10px 12px; border:1px solid var(--border-color, #e2e8f0); border-radius:8px; background:var(--card-bg, #fff); color:var(--text-primary, #0f172a); font-size:14px; box-sizing:border-box;"></select>
        </div>
        <div>
          <label style="display:block; font-size:11px; font-weight:600; color:var(--text-secondary, #64748b); margin-bottom:6px; text-transform:uppercase;">Role</label>
          <select id="modalRole" style="width:100%; padding:10px 12px; border:1px solid var(--border-color, #e2e8f0); border-radius:8px; background:var(--card-bg, #fff); color:var(--text-primary, #0f172a); font-size:14px; box-sizing:border-box;"></select>
        </div>
      </div>
      <div id="customChannelWrapper" style="margin-bottom:20px; display:none;">
        <label style="display:block; font-size:11px; font-weight:600; color:var(--text-secondary, #64748b); margin-bottom:6px; text-transform:uppercase;">Custom Channel Name</label>
        <input type="text" id="modalCustomChannel" placeholder="Enter custom channel name..." style="width:100%; padding:10px 12px; border:1px solid var(--border-color, #e2e8f0); border-radius:8px; background:var(--card-bg, #fff); color:var(--text-primary, #0f172a); font-size:14px; box-sizing:border-box;">
      </div>
      <div style="display:flex; justify-content:space-between; padding-top:16px; border-top:1px solid var(--border-color, #e2e8f0);">
        <button type="button" id="modalDeleteBtn" onclick="deleteShift()" style="background:#fef2f2; color:#dc2626; border:1px solid #fecaca; padding:10px 16px; border-radius:8px; cursor:pointer; font-weight:600; font-size:13px;">Delete</button>
        <div style="display:flex; gap:10px;">
          <button type="button" onclick="closeModal()" style="background:var(--bg-tertiary, #f1f5f9); color:var(--text-secondary, #64748b); border:1px solid var(--border-color, #e2e8f0); padding:10px 16px; border-radius:8px; cursor:pointer; font-weight:600; font-size:13px;">Cancel</button>
          <button type="button" onclick="saveShift()" style="background:#b37e78; color:white; border:none; padding:10px 16px; border-radius:8px; cursor:pointer; font-weight:600; font-size:13px;">Save</button>
        </div>
      </div>
    </div>
  </div>
  <!-- OVERLAYS -->
  <div id="modalOverlay" class="overlay" onclick="if(event.target===this) closeModal()">
    <div class="modal" style="width: 420px; border-radius: 16px; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);">
      <!-- Modern Header with gradient -->
      <div class="mHead" style="background: linear-gradient(135deg, #b37e78 0%, #8f5f5a 100%); border-bottom: none; padding: 20px;">
        <div style="display: flex; align-items: center; gap: 12px;">
          <div style="width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
            <span style="font-size: 18px;">üîÑ</span>
          </div>
          <div>
            <span class="mTitle" style="color: white; font-size: 18px; font-weight: 700;">Replace Coverage</span>
            <div id="mSub" style="color: rgba(255,255,255,0.8); font-size: 12px; margin-top: 2px;"></div>
          </div>
        </div>
        <button type="button" class="btn ghost" style="padding: 8px; color: white; background: rgba(255,255,255,0.1); border-radius: 8px;" onclick="closeModal()">‚úï</button>
      </div>
      
      <div class="mBody" style="padding: 24px;">
        <!-- Replace With Section -->
        <div style="margin-bottom: 20px;">
          <label style="display: block; font-size: 11px; font-weight: 700; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">Replace With</label>
          <select id="mNewPerson" style="width: 100%; padding: 14px 16px; border: 1px solid var(--border-color, #e2e8f0); border-radius: 12px; font-size: 15px; font-weight: 700; color: var(--text-primary, #1e293b); background: var(--bg-secondary, #f8fafc); cursor: pointer; transition: all 0.2s;"></select>
        </div>
        
        <!-- Notification Section -->
        <div style="margin-bottom: 20px;">
          <label style="display: block; font-size: 11px; font-weight: 700; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">Notification</label>
          <select id="mNotify" style="width: 100%; padding: 14px 16px; border: 1px solid var(--border-color, #e2e8f0); border-radius: 12px; font-size: 15px; font-weight: 700; color: var(--text-primary, #1e293b); background: var(--bg-secondary, #f8fafc); cursor: pointer; transition: all 0.2s;">
            <option value="send">ü§ñ Notify now (Google Chat)</option>
            <option value="defer">üïí Notify later (queue)</option>
          </select>
          <div style="margin-top:8px; font-size:12px; color: var(--text-secondary, #64748b); font-weight:600;">
            ‚ÄúNotify later‚Äù keeps it in the manager queue until you send.
          </div>
        </div>
        
        <!-- Notes Section -->
        <div style="margin-bottom: 20px;">
          <label style="display: block; font-size: 11px; font-weight: 700; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;">Notes</label>
          <textarea id="mNotes" placeholder="Add any notes about this change..." style="width: 100%; min-height: 84px; padding: 14px 16px; border: 1px solid var(--border-color, #e2e8f0); border-radius: 12px; font-size: 14px; color: var(--text-primary, #1e293b); background: var(--bg-secondary, #f8fafc); resize: vertical; font-family: inherit; transition: all 0.2s; box-sizing: border-box;"></textarea>
        </div>
        
        <!-- Make-Up Date Section (Optional) -->
        <div id="mMakeUpSection" style="margin-bottom: 20px;">
          <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
            <input type="checkbox" id="mRequireMakeUp" onchange="toggleMakeUpDate()" style="width: 16px; height: 16px; accent-color: #b37e78; cursor: pointer;">
            <label for="mRequireMakeUp" style="font-size: 11px; font-weight: 700; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; cursor: pointer;">Agent Needs to Make Up Hours</label>
          </div>
          <div id="mMakeUpDateWrap" style="display: none;">
            <div style="padding: 12px; background: #fef3c7; border: 1px solid #fcd34d; border-radius: 8px; margin-bottom: 8px;">
              <div style="font-size: 11px; color: #92400e; font-weight: 600; margin-bottom: 4px;">üí° Make-Up Date Selection</div>
              <div style="font-size: 10px; color: #78350f;">Agent will need to work these hours on another date. Choose suggested date(s):</div>
            </div>
            <div style="display: flex; gap: 8px; margin-bottom: 8px;">
              <input type="date" id="mMakeUpDate" style="flex: 1; padding: 10px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 13px; box-sizing: border-box;">
              <button type="button" onclick="addManagerMakeUpDate()" style="padding: 10px 16px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; white-space: nowrap; font-size: 13px;">+ Add</button>
            </div>
            <div id="mMakeUpDatesList" style="display: flex; flex-wrap: wrap; gap: 6px;"></div>
          </div>
        </div>
        
        <!-- Quick Actions -->
        <div style="display: flex; gap: 10px; padding-top: 8px; border-top: 1px solid var(--border-color, #e2e8f0);">
          <button id="actionBtn" onclick="markTimeOff()" style="display: flex; align-items: center; gap: 6px; padding: 10px 14px; background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); color: #dc2626; border: 1px solid #fecaca; border-radius: 10px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 2px 8px rgba(220,38,38,0.2)'" onmouseout="this.style.transform='none'; this.style.boxShadow='none'">
            <span>‚õî</span> Mark Off
          </button>
          <button id="btnDeleteShift" onclick="deleteLiveShiftFromReplace()" style="display: none; align-items: center; gap: 6px; padding: 10px 14px; background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); color: #dc2626; border: 1px solid #fecaca; border-radius: 10px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 2px 8px rgba(220,38,38,0.2)'" onmouseout="this.style.transform='none'; this.style.boxShadow='none'">
            <span>üóëÔ∏è</span> Delete
          </button>
        </div>
      </div>
      
      <!-- Footer -->
      <div class="mFoot" style="background: var(--bg-secondary, #f8fafc); padding: 16px 24px; border-top: 1px solid var(--border-color, #e2e8f0); display: flex; justify-content: flex-end; gap: 10px;">
        <button class="btn ghost" onclick="closeModal()" style="padding: 12px 20px; background: var(--card-bg, #ffffff); color: var(--text-secondary, #64748b); border: 1px solid var(--border-color, #e2e8f0); border-radius: 10px; font-size: 14px; font-weight: 700; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background=getComputedStyle(document.body).getPropertyValue('--bg-tertiary')||'#f1f5f9'" onmouseout="this.style.background=getComputedStyle(document.body).getPropertyValue('--card-bg')||'#ffffff'">Cancel</button>
        <button class="btn primary" id="mSave" onclick="saveReplace()" style="padding: 12px 24px; background: linear-gradient(135deg, #b37e78 0%, #8f5f5a 100%); color: white; border: none; border-radius: 10px; font-size: 14px; font-weight: 700; cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 8px rgba(179,126,120,0.3);" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(179,126,120,0.4)'" onmouseout="this.style.transform='none'; this.style.boxShadow='0 2px 8px rgba(179,126,120,0.3)'">Save Changes</button>
      </div>
    </div>
  </div>
<!-- Holiday Management Modal -->
<div id="holidayModal" class="overlay overlay-sub" style="display:none;" onclick="if(event.target===this) closeHolidayModal()">
  <div class="modal" style="width: 500px;">
    <div class="mHead">
      <span class="mTitle">üéÑ Manage Holidays</span>
      <button type="button" class="btn ghost" style="padding:6px 12px;" onclick="closeHolidayModal()">‚úï</button>
    </div>
    
    <div class="mBody">
      <!-- Add Holiday Form -->
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; padding:16px; background:#f8fafc; border-radius:10px; margin-bottom:20px;">
        <div>
          <label style="font-size:11px; font-weight:600; color:#64748b; display:block; margin-bottom:4px;">DATE</label>
          <input type="date" id="holidayDate" style="width:100%; padding:8px 12px; border:1px solid #e2e8f0; border-radius:6px; font-size:14px;" />
        </div>
        <div>
          <label style="font-size:11px; font-weight:600; color:#64748b; display:block; margin-bottom:4px;">HOLIDAY NAME</label>
          <input type="text" id="holidayName" placeholder="e.g., Christmas Day" style="width:100%; padding:8px 12px; border:1px solid #e2e8f0; border-radius: 6px; font-size:14px;" />
        </div>
        <div>
          <label style="font-size:11px; font-weight:600; color:#64748b; display: block; margin-bottom:4px;">THEME</label>
          <select id="holidayTheme" style="width:100%; padding:8px 12px; border:1px solid #e2e8f0; border-radius:6px; font-size:14px;">
            <option value="christmas">üéÑ Christmas</option>
            <option value="newyear">üéÜ New Year</option>
            <option value="july4th">üá∫üá∏ July 4th</option>
            <option value="halloween">üéÉ Halloween</option>
            <option value="thanksgiving">ü¶É Thanksgiving</option>
            <option value="valentines">üíñ Valentine's</option>
            <option value="stpatricks">üíö St. Patrick's</option>
            <option value="easter">üê£ Easter</option>
            <option value="default">‚≠ê Generic</option>
          </select>
        </div>
        <div>
          <label style="font-size:11px; font-weight:600; color:#64748b; display:block; margin-bottom:4px;">EMOJI</label>
          <select id="holidayEmoji" style="width:100%; padding:8px 12px; border:1px solid #e2e8f0; border-radius:6px; font-size:14px;">
            <option value="üéÑ">üéÑ</option>
            <option value="üéÜ">üéÜ</option>
            <option value="üá∫üá∏">üá∫üá∏</option>
            <option value="üéÉ">üéÉ</option>
            <option value="ü¶É">ü¶É</option>
            <option value="üíñ">üíñ</option>
            <option value="üíö">üíö</option>
            <option value="üê£">üê£</option>
            <option value="‚≠ê">‚≠ê</option>
          </select>
        </div>
        <button onclick="addHoliday()" style="grid-column: 1 / -1; background:#b37e78; color: white; border:none; border-radius:8px; padding:12px; font-weight:600; cursor: pointer; font-size:14px;">
          + Add Holiday
        </button>
      </div>
      
      <!-- Holiday List -->
      <label style="font-size:11px; font-weight:600; color:#64748b; display:block; margin-bottom:12px;">SCHEDULED HOLIDAYS</label>
      <div id="holidayList" style="max-height:250px; overflow-y:auto;">
        <div style="text-align:center; color:#94a3b8; padding:20px;">Loading... </div>
      </div>
    </div>
  </div>
</div>
  <div id="profileOverlay" class="overlay" onclick="if(event.target===this) closeProfile()">
    <div class="modal" style="width: 400px;">
      <div class="mHead" style="background: #f8fafc; border-bottom: 1px solid #e2e8f0;">
        <span class="mTitle">Agent Profile</span>
        <button type="button" class="btn ghost" style="padding:4px 8px;" onclick="closeProfile()">‚úï</button>
      </div>
      <div class="mBody" style="text-align: center; padding: 30px;">
        <div id="profLoader" style="color: #64748b; font-size: 13px;"><div>Fetching live metrics from Zendesk...</div></div>
        <div id="profContent" style="display:none;">
          <img id="pAvatar" src="" style="width: 80px; height: 80px; border-radius: 50%; background: #e2e8f0; margin-bottom: 15px; border: 3px solid #fff; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
          <h2 id="pName" style="margin: 0 0 5px 0; font-size: 20px; color: #0f172a;">Name</h2>
          <div id="pEmail" style="font-size: 12px; color: #64748b; margin-bottom: 20px;"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c7a2aaa6aeab87a2bfa6aab7aba2e9a4a8aa">[email&#160;protected]</a></div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; text-align: left;">
            <div style="background: #f0f9ff; padding: 10px; border-radius: 8px; border: 1px solid #bae6fd;">
              <div style="font-size: 10px; font-weight: 700; color: #0369a1;">OPEN TICKETS</div>
              <div id="pTickets" style="font-size: 20px; font-weight: 800; color: #0284c7;">--</div>
            </div>
            <div style="background:#fdf2f8; padding:10px; border-radius:8px; border:1px solid #fbcfe8;">
              <div style="font-size:10px; font-weight:700; color:#be185d;">ROLE</div>
              <div id="pRole" style="font-size:14px; font-weight:800; color:#db2777;">--</div>
            </div>
          </div>
          <div style="margin-top: 10px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; font-size: 11px; color: var(--text-secondary); text-align: center;">
            üí° For CSAT &amp; Solved metrics, view <a href="https://musely.zendesk.com/explore" target="_blank" style="color: var(--accent-primary);">Zendesk Explore</a>
          </div>
          <div style="margin-top: 12px; font-size: 11px; color: #94a3b8;">Last Login: <span id="pLogin">--</span></div>
          
          <!-- ‚úÖ Logout Button -->
          <div style="margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border-color);">
            <button onclick="handleLogout()" style="
              background: transparent;
              color: #dc2626;
              border: 1px solid #fecaca;
              padding: 10px 20px;
              border-radius: 8px;
              font-size: 13px;
              font-weight: 600;
              cursor: pointer;
              transition: all 0.2s;
              display: inline-flex;
              align-items: center;
              gap: 8px;
            " onmouseover="this.style.background='#fef2f2'; this.style.borderColor='#dc2626';" 
               onmouseout="this.style.background='transparent'; this.style.borderColor='#fecaca';">
              üö™ Sign Out
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="masterOverlay" class="overlay" onclick="if(event.target===this) closeMasterModal()">
    <div class="modal">
      <div class="mHead">
        <span class="mTitle">Edit Master Template</span>
        <button type="button" class="btn ghost" style="padding:6px 12px;" onclick="closeMasterModal()">‚úï</button>
      </div>
      <div class="mBody">
        <div style="margin-bottom:16px; font-size:13px; color:#64748b;" id="mstSub"></div>
        <input type="hidden" id="mstPerson">
        <input type="hidden" id="mstDay">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:12px;">
          <div><label>Start Time (PST)</label><input id="mstStart" placeholder="e.g. 8:00 AM"></div>
          <div><label>End Time (PST)</label><input id="mstEnd" placeholder="e.g. 5:00 PM"></div>
        </div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-bottom:12px;">
          <div><label>Team</label><select id="mstTeam"></select></div>
          <div><label>Role</label><select id="mstRole"></select></div>
        </div>
        <div style="background:#f0f9ff; padding:12px; border-radius:8px; border:1px solid #bae6fd; font-size:12px; color:#0369a1; display:flex; gap:10px; align-items:start;">
          <input type="checkbox" id="mstSync" style="width:auto; margin-top:2px;">
          <span><b>Sync to LIVE Schedule?</b><br>Check this to update all future shifts starting <b>tomorrow</b>. Leave unchecked to only update the template for new generations.</span>
        </div>
      </div>
      <div class="mFoot">
        <button class="btn ghost" onclick="closeMasterModal()">Cancel</button>
        <button class="btn primary" onclick="saveMasterEdit()">Save Changes</button>
      </div>
    </div>
  </div>
  <div id="pickerOverlay" class="overlay" onclick="if(event.target===this) closePicker()">
    <div class="modal" style="width: 500px; height: 600px; display:flex; flex-direction:column;">
      <div class="mHead">
        <span class="mTitle">Filter People</span>
        <button type="button" class="btn ghost" style="padding:6px 12px;" onclick="closePicker()">‚úï</button>
      </div>
      <div style="padding:16px; border-bottom:1px solid #e2e8f0; display:flex; gap:12px;">
        <input id="pickerSearch" placeholder="Search..." oninput="renderPickerList()" style="flex:1;">
        <button class="btn ghost" onclick="pickerToggleAll(true)">All</button>
        <button class="btn ghost" onclick="pickerToggleAll(false)">None</button>
      </div>
      <div id="pickerList" class="pickerList" style="flex:1; overflow-y:auto; padding:8px;"></div>
      <div class="mFoot"><button class="btn primary" onclick="applyPicker()">Apply Filter</button></div>
    </div>
  </div>
  <!-- ‚úÖ Admin Overlay (ONLY ONCE) -->
  <div id="adminOverlay" class="overlay overlay-admin" style="display:none;" onclick="if(event.target===this) closeAdminModal()">
    <div class="modal adminModal">
      <div class="mHead adminHead">
        <div class="adminHeadLeft">
          <div class="adminHeadIcon">‚öôÔ∏è</div>
          <div>
            <div class="mTitle adminTitle">Admin Tools</div>
            <div class="adminSubtitle">Manage queues, balances, rules, and system actions.</div>
          </div>
        </div>
        <button type="button" class="iconClose" onclick="closeAdminModal()" aria-label="Close">‚úï</button>
      </div>

      <div class="mBody adminBody">
        <!-- Audit Log (full width) -->
        <div class="adminStrip">
          <div class="adminStripLeft">
            <div class="adminStripIcon">üßæ</div>
            <div>
              <div class="adminStripTitle">Audit Log</div>
              <div class="adminStripDesc">View history &amp; log end-of-day reports</div>
            </div>
          </div>
          <div class="adminStripActions">
            <button type="button" class="btn ghost adminBtnSm" onclick="logEndOfDaySummary()">üìù Log EOD</button>
            <button type="button" class="btn ghost adminBtnSm" onclick="openAuditLog()">View</button>
          </div>
        </div>

        <!-- Tool grid -->
        <div class="adminGrid">
          <div class="adminCard" onclick="openBalanceModal()">
            <div class="adminCardTop">
              <div class="adminIcon adminIconGreen">üí∞</div>
              <div class="adminCardText">
                <div class="adminCardTitle">PTO Balance</div>
                <div class="adminCardDesc">Adjust PTO hours (incl. bulk add)</div>
              </div>
              <span class="adminChip">Manage</span>
            </div>
          </div>

          <div class="adminCard" onclick="openHolidayModal()">
            <div class="adminCardTop">
              <div class="adminIcon adminIconBlue">üéâ</div>
              <div class="adminCardText">
                <div class="adminCardTitle">Company Holidays</div>
                <div class="adminCardDesc">Manage holiday dates</div>
              </div>
              <span class="adminChip">Edit</span>
            </div>
          </div>

          <div class="adminCard" onclick="openStaffingModal()">
            <div class="adminCardTop">
              <div class="adminIcon adminIconPurple">üõ°Ô∏è</div>
              <div class="adminCardText">
                <div class="adminCardTitle">Staffing Rules</div>
                <div class="adminCardDesc">Minimum agents per channel</div>
              </div>
              <span class="adminChip">Rules</span>
            </div>
          </div>

          <!-- Agents (this matches your existing function name) -->
          <div class="adminCard" onclick="openManageAgentsModal()">
            <div class="adminCardTop">
              <div class="adminIcon adminIconSlate">üë•</div>
              <div class="adminCardText">
                <div class="adminCardTitle">Agents</div>
                <div class="adminCardDesc">Add / edit agent access</div>
              </div>
              <span class="adminChip">Admin</span>
            </div>
          </div>

          <!-- Meeting Rotation (NEW) -->
          <div class="adminCard" onclick="openMeetingRotationModal()">
            <div class="adminCardTop">
              <div class="adminIcon adminIconOrange">üìÖ</div>
              <div class="adminCardText">
                <div class="adminCardTitle">Meeting Rotation</div>
                <div class="adminCardDesc">Thursday Live Chat coverage</div>
              </div>
              <span class="adminChip">Rotation</span>
            </div>
          </div>

          <!-- Weekly Assignments (NEW) -->
          <div class="adminCard" onclick="openWeeklyAssignmentsModal()">
            <div class="adminCardTop">
              <div class="adminIcon adminIconTeal">üéØ</div>
              <div class="adminCardText">
                <div class="adminCardTitle">Weekly Assignments</div>
                <div class="adminCardDesc">Tips, Moments, Walkthroughs</div>
              </div>
              <span class="adminChip">Assign</span>
            </div>
          </div>

          <!-- Clear Event History -->
          <div class="adminCard" onclick="openClearEventsModal()">
            <div class="adminCardTop">
              <div class="adminIcon adminIconRed">üóëÔ∏è</div>
              <div class="adminCardText">
                <div class="adminCardTitle">Clear Event History</div>
                <div class="adminCardDesc">Remove test data / old events</div>
              </div>
              <span class="adminChip">Clean</span>
            </div>
          </div>

        <!-- Danger Zone -->
        <div class="dangerCard">
          <div class="dangerTop">
            <div>
              <div class="dangerTitle">Danger Zone</div>
              <div class="dangerDesc">Bulk delete or regenerate schedule</div>
            </div>
            <div class="dangerActions">
              <button type="button" class="btn ghost dangerBtn" onclick="wipeFutureSchedule()">Wipe Future</button>
              <button type="button" class="btn danger dangerBtnPrimary" onclick="regenerateAllSchedule()">Regenerate</button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

      </div>
      <div id="staffingModal" class="overlay" style="display:none;" onclick="if(event.target===this) closeStaffingModal()">
  <div class="modal" style="width: 500px;">
    <div class="mHead">
      <span class="mTitle">üõ°Ô∏è Staffing Requirements</span>
      <button type="button" class="btn ghost" onclick="closeStaffingModal()">‚úï</button>
    </div>
    <div class="mBody">
      <div style="background:#f8fafc; padding:16px; border-radius:8px; margin-bottom:16px; border:1px solid #e2e8f0;">
        <label>Add New Rule</label>
        <div style="display:flex; gap:8px; margin-bottom:8px;">
          <select id="ruleTeam" style="flex:2;"><option value="">Select Team...</option></select>
          <select id="ruleDay" style="flex:1;">
            <option value="All">Every Day</option>
            <option value="Weekday">Mon-Fri</option>
            <option value="Weekend">Sat-Sun</option>
            <option value="Mon">Mon</option><option value="Tue">Tue</option><option value="Wed">Wed</option>
            <option value="Thu">Thu</option><option value="Fri">Fri</option><option value="Sat">Sat</option><option value="Sun">Sun</option>
          </select>
          <input id="ruleMin" type="number" placeholder="Min" style="flex:1; width:60px;">
        </div>
        <div style="display:flex; gap:8px; margin-bottom:8px;">
          <select id="ruleTimeBlock" style="flex:1;">
            <option value="all">All Hours</option>
            <option value="morning">Morning (6a-12p)</option>
            <option value="afternoon">Afternoon (12p-6p)</option>
            <option value="evening">Evening (6p-10p)</option>
            <option value="custom">Custom Hours</option>
          </select>
          <input id="ruleStartHour" type="number" min="0" max="23" placeholder="Start" style="flex:1; display:none;">
          <input id="ruleEndHour" type="number" min="0" max="23" placeholder="End" style="flex:1; display:none;">
        </div>
        <button class="btn primary" style="width:100%;" onclick="addRule()">+ Save Requirement</button>
      </div>
      
      <div style="background:#fbf6f5; padding:12px; border-radius:8px; margin-bottom:16px; border:1px solid #bfdbfe;">
        <div style="font-size:11px; font-weight:700; color:#b37e78; margin-bottom:6px;">üí° Recommended Rules</div>
        <div style="display:flex; flex-wrap:wrap; gap:6px;">
          <button class="btn ghost" style="font-size:10px; padding:4px 8px;" onclick="addQuickRule('Live Chat', 3, 'morning')">LC 3+ (AM)</button>
          <button class="btn ghost" style="font-size:10px; padding:4px 8px;" onclick="addQuickRule('Phone', 2, 'all')">Phone 2+</button>
          <button class="btn ghost" style="font-size:10px; padding:4px 8px;" onclick="addQuickRule('MD Support', 1, 'all')">MD 1+</button>
        </div>
      </div>
      
      <label>Current Rules</label>
      <div id="ruleList" style="max-height:200px; overflow-y:auto; display:flex; flex-direction:column; gap:8px;"></div>
    </div>
  </div>
</div>

  <!-- Clear Events Modal -->
  <div id="clearEventsModal" class="overlay" style="display:none;" onclick="if(event.target===this) closeClearEventsModal()">
    <div class="modal" style="width: 520px; max-width: 92vw;">
      <div class="mHead" style="background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); border-bottom: none;">
        <span class="mTitle" style="color: white;">üóëÔ∏è Clear Event History</span>
        <button type="button" class="btn ghost" style="color:white; background:rgba(255,255,255,0.15); border:1px solid rgba(255,255,255,0.25); padding:6px 12px;" onclick="closeClearEventsModal()">‚úï</button>
      </div>
      <div class="mBody" style="max-height: 70vh; overflow-y: auto; padding: 20px;">

        <!-- Warning Banner -->
        <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 10px; padding: 14px 16px; margin-bottom: 20px; display: flex; gap: 12px; align-items: flex-start;">
          <span style="font-size: 22px; line-height: 1;">‚ö†Ô∏è</span>
          <div>
            <div style="font-weight: 700; font-size: 13px; color: #991b1b; margin-bottom: 3px;">Caution: Permanent Deletion</div>
            <div style="font-size: 12px; color: #7f1d1d; line-height: 1.5;">This will permanently delete event history data. This action cannot be undone. Use this to clear test data or old records that are affecting attendance scores.</div>
          </div>
        </div>

        <!-- Date Filter -->
        <div style="margin-bottom: 20px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px; font-weight: 600; color: var(--text-primary);">
            <input type="checkbox" id="clearEventsUseDateFilter" onchange="toggleClearEventsDateFilter()" style="width: 16px; height: 16px; accent-color: #dc2626; flex-shrink: 0;">
            Only delete events before a specific date
          </label>
          <input type="date" id="clearEventsBeforeDate" class="fieldInput" style="width: 100%; display: none; margin-top: 8px; padding: 8px 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 13px;" title="Delete only events created before this date">
        </div>

        <!-- Collections to Clear -->
        <div style="margin-bottom: 20px;">
          <div style="font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-secondary); margin-bottom: 10px;">Select data to clear:</div>
          <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 10px; overflow: hidden;">
            <label class="clear-events-option">
              <input type="checkbox" class="clearEventsCollection" value="time_off_requests" checked>
              <div class="clear-events-option-icon" style="background: #dbeafe;">üèñÔ∏è</div>
              <div class="clear-events-option-text">
                <span class="clear-events-option-name">Time Off Requests</span>
                <span class="clear-events-option-desc">PTO, sick days</span>
              </div>
            </label>
            <label class="clear-events-option">
              <input type="checkbox" class="clearEventsCollection" value="swap_requests" checked>
              <div class="clear-events-option-icon" style="background: #fef3c7;">üîÑ</div>
              <div class="clear-events-option-text">
                <span class="clear-events-option-name">Swap Requests</span>
                <span class="clear-events-option-desc">Shift swaps</span>
              </div>
            </label>
            <label class="clear-events-option">
              <input type="checkbox" class="clearEventsCollection" value="agent_notifications">
              <div class="clear-events-option-icon" style="background: #e0e7ff;">üîî</div>
              <div class="clear-events-option-text">
                <span class="clear-events-option-name">Agent Notifications</span>
                <span class="clear-events-option-desc">Alerts sent to agents</span>
              </div>
            </label>
            <label class="clear-events-option">
              <input type="checkbox" class="clearEventsCollection" value="manager_notifications">
              <div class="clear-events-option-icon" style="background: #fce7f3;">üì£</div>
              <div class="clear-events-option-text">
                <span class="clear-events-option-name">Manager Notifications</span>
                <span class="clear-events-option-desc">Alerts sent to managers</span>
              </div>
            </label>
            <label class="clear-events-option">
              <input type="checkbox" class="clearEventsCollection" value="audit_log">
              <div class="clear-events-option-icon" style="background: #f1f5f9;">üìã</div>
              <div class="clear-events-option-text">
                <span class="clear-events-option-name">Audit Log</span>
                <span class="clear-events-option-desc">Activity history</span>
              </div>
            </label>
            <label class="clear-events-option" style="border-bottom: none;">
              <input type="checkbox" class="clearEventsCollection" value="holiday_transactions">
              <div class="clear-events-option-icon" style="background: #dcfce7;">üéÑ</div>
              <div class="clear-events-option-text">
                <span class="clear-events-option-name">Holiday Transactions</span>
                <span class="clear-events-option-desc">Holiday tracking</span>
              </div>
            </label>
          </div>
        </div>

        <!-- Confirmation -->
        <div style="background: #fffbeb; border: 1px solid #fde68a; border-radius: 10px; padding: 14px 16px; margin-bottom: 20px;">
          <label style="display: flex; align-items: flex-start; gap: 10px; cursor: pointer;">
            <input type="checkbox" id="clearEventsConfirm" style="width: 18px; height: 18px; accent-color: #dc2626; flex-shrink: 0; margin-top: 1px;">
            <span style="font-size: 13px; font-weight: 600; color: #92400e; line-height: 1.4;">I understand this will permanently delete the selected data</span>
          </label>
        </div>

        <!-- Action Buttons -->
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
          <button type="button" class="btn ghost" onclick="closeClearEventsModal()" style="padding: 10px 20px; font-size: 13px;">Cancel</button>
          <button type="button" class="btn danger" onclick="executeClearEvents()" style="padding: 10px 20px; font-size: 13px; min-width: 160px; background: #dc2626; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
            üóëÔ∏è Clear Selected Data
          </button>
        </div>
      </div>
    </div>
  </div>

  

  <!-- ‚úÖ Audit Overlay (sibling, not nested) -->
  <div id="auditOverlay" class="overlay" style="display:none;" onclick="if(event.target===this) closeAuditModal()">
    <div class="modal" style="width: 700px; max-width: 90vw; height: 80vh; display:flex; flex-direction:column;">
      <div class="mHead">
        <span class="mTitle">Audit History</span>
        <div style="display:flex; gap:8px; align-items:center;">
          <button type="button" class="btn ghost" style="padding:6px 12px; font-size:11px; color:#ef4444;" onclick="clearAuditHistory()" title="Clear audit history">üóëÔ∏è Clear</button>
          <button type="button" class="btn ghost" style="padding:6px 12px;" onclick="closeAuditModal()">‚úï</button>
        </div>
      </div>
      <div class="mBody" style="flex:1; overflow:hidden; padding:0; display:flex; flex-direction:column;">
        <div style="background:#fff; border-bottom:1px solid #e2e8f0; padding:10px 16px; font-size:12px; color:#64748b;">
          Showing last 50 actions. Newest first.
        </div>
        <div style="flex:1; overflow-y:auto;">
          <table class="audit-table">
            <thead>
              <tr>
                <th style="width:140px;">Time</th>
                <th style="width:120px;">Manager</th>
                <th style="width:100px;">Action</th>
                <th style="width:120px;">Target</th>
                <th>Details</th>
              </tr>
            </thead>
            <tbody id="auditList">
              <tr><td colspan="5" style="text-align:center; padding:20px; color:#94a3b8;">Loading history...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <!-- Master Context -->
  <div id="masterContextOverlay" class="overlay" style="display:none; z-index:200;">
    <div class="modal" style="width: 400px;">
      <div class="mHead"><span class="mTitle">Select Manager Context</span></div>
      <div class="mBody">
        <p style="font-size:13px; color:#64748b; margin-bottom:12px;">
          You are logged in as <b>Master Admin</b>.<br>
          Please select which Manager's schedule you wish to view/manage.
        </p>
        <label>Available Managers</label>
        <select id="masterManagerDropdown" style="width:100%; padding:8px; border:1px solid #cbd5e1; border-radius:6px;">
          <option value="" disabled selected>Loading...</option>
        </select>
      </div>
      <div class="mFoot" style="justify-content:flex-end;">
        <button type="button" class="btn primary" id="btnConfirmManager" onclick="confirmManagerSelection()">Load Dashboard</button>
      </div>
    </div>
  </div>
  
  <!-- Meeting Rotation Modal (Enhanced) -->
  <div id="meetingRotationModal" class="overlay" style="display:none;" onclick="if(event.target===this) closeMeetingRotationModal()">
    <div class="modal" style="width: 600px; max-height: 85vh; display: flex; flex-direction: column; overflow: hidden;">
      <!-- Sticky Header -->
      <div class="mHead" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); flex-shrink: 0; position: sticky; top: 0; z-index: 10;">
        <span class="mTitle" style="color: white;">üìÖ Meeting Rotation</span>
        <button type="button" class="btn ghost" style="color: white; font-size: 18px; padding: 4px 10px;" onclick="closeMeetingRotationModal()">‚úï</button>
      </div>
      
      <!-- Scrollable Body -->
      <div class="mBody" style="overflow-y: auto; flex: 1; padding: 16px;">
        <!-- Quick Setup Row -->
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 16px;">
          <div>
            <label style="font-size: 11px; color: var(--text-secondary); display: block; margin-bottom: 4px;">Type</label>
            <select id="rotationMeetingType" style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--input-bg); color: var(--text-primary); font-size: 12px;" onchange="onMeetingTypeChange()">
              <option value="thursday">Thursday (Weekly)</option>
              <option value="wednesday">Wednesday (Monthly)</option>
              <option value="allhands">All Hands</option>
            </select>
          </div>
          <div>
            <label style="font-size: 11px; color: var(--text-secondary); display: block; margin-bottom: 4px;">Date</label>
            <input type="date" id="rotationDate" style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--input-bg); color: var(--text-primary); font-size: 12px;" onchange="loadRotationForDate()">
          </div>
          <div>
            <label style="font-size: 11px; color: var(--text-secondary); display: block; margin-bottom: 4px;">Time (PST)</label>
            <select id="rotationTimePST" style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--input-bg); color: var(--text-primary); font-size: 12px;">
              <option value="12:00 PM - 1:15 PM">12:00 PM - 1:15 PM</option>
              <option value="12:45 PM - 2:00 PM">12:45 PM - 2:00 PM</option>
              <option value="4:00 PM - 5:00 PM">4:00 PM - 5:00 PM</option>
              <option value="11:00 AM - 12:00 PM">11:00 AM - 12:00 PM</option>
              <option value="1:00 PM - 2:00 PM">1:00 PM - 2:00 PM</option>
              <option value="2:00 PM - 3:00 PM">2:00 PM - 3:00 PM</option>
              <option value="3:00 PM - 4:00 PM">3:00 PM - 4:00 PM</option>
            </select>
          </div>
        </div>
        
        <!-- Hidden EST time selector -->
        <select id="rotationTimeEST" style="display: none;" onchange="convertMeetingTime()">
          <option value="3:00 PM - 4:15 PM">3:00 PM - 4:15 PM</option>
          <option value="3:45 PM - 5:00 PM">3:45 PM - 5:00 PM</option>
          <option value="7:00 PM - 8:00 PM">7:00 PM - 8:00 PM</option>
        </select>
        
        <!-- Coverage Assignment Card -->
        <div style="background: var(--bg-tertiary); border-radius: 10px; padding: 14px; margin-bottom: 14px;">
          <div style="font-weight: 700; font-size: 13px; margin-bottom: 6px; color: var(--text-primary);">üë• Live Chat Coverage During Meeting</div>
          <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 12px; padding: 10px; background: var(--bg-secondary); border-radius: 6px; border-left: 3px solid #6366f1;">
            <div style="font-weight: 600; margin-bottom: 4px;">üìã Who does what:</div>
            <div>‚Ä¢ <strong style="color: #1e40af;">LC Agents</strong> = <strong>MISS</strong> meeting (cover Live Chat)</div>
            <div>‚Ä¢ <strong style="color: #065f46;">Backups</strong> = <strong>ATTEND</strong> meeting (set Away, jump in if busy)</div>
            <div>‚Ä¢ <strong style="color: #92400e;">Captain</strong> = <strong>ATTEND</strong> meeting (steers ship, last resort)</div>
            <div style="margin-top: 6px; font-style: italic;">Queue priority: LC Agents ‚Üí Backups ‚Üí Captain</div>
          </div>
          
          <!-- Role Grid -->
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px;">
            <!-- Captain -->
            <div style="background: #fef3c7; padding: 10px; border-radius: 8px; border-left: 3px solid #f59e0b;">
              <div style="font-size: 11px; font-weight: 600; color: #92400e; margin-bottom: 6px;">üë§ Captain <span style="font-weight: 400; opacity: 0.8;">(Attends - Last Resort)</span></div>
              <select id="rotationCaptain" style="width: 100%; padding: 6px 8px; border: 1px solid #fcd34d; border-radius: 4px; background: white; font-size: 12px; color: #333;">
                <option value="">-- Select --</option>
              </select>
            </div>
            
            <!-- Notes -->
            <div style="background: var(--bg-secondary); padding: 10px; border-radius: 8px; border: 1px solid var(--border-color);">
              <div style="font-size: 11px; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">üìù Notes</div>
              <input type="text" id="rotationNotes" placeholder="Social Segment, Team Building..." style="width: 100%; padding: 6px 8px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--input-bg); font-size: 12px; color: var(--text-primary);">
            </div>
          </div>
          
          <!-- Backups Row -->
          <div style="background: #d1fae5; padding: 10px; border-radius: 8px; border-left: 3px solid #10b981; margin-bottom: 10px;">
            <div style="font-size: 11px; font-weight: 600; color: #065f46; margin-bottom: 6px;">üîÑ Backups <span style="font-weight: 400; opacity: 0.8;">(Attend Meeting - Away in Zendesk)</span></div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
              <select id="rotationBackup1" style="width: 100%; padding: 6px 8px; border: 1px solid #6ee7b7; border-radius: 4px; background: white; font-size: 12px; color: #333;">
                <option value="">Backup #1</option>
              </select>
              <select id="rotationBackup2" style="width: 100%; padding: 6px 8px; border: 1px solid #6ee7b7; border-radius: 4px; background: white; font-size: 12px; color: #333;">
                <option value="">Backup #2</option>
              </select>
            </div>
          </div>
          
          <!-- LC Agents -->
          <div style="background: #dbeafe; padding: 10px; border-radius: 8px; border-left: 3px solid #3b82f6;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
              <div style="font-size: 11px; font-weight: 600; color: #1e40af;">üí¨ LC Agents <span style="font-weight: 400; opacity: 0.8;">(Miss Meeting - Cover LC)</span></div>
              <div style="display: flex; gap: 4px;">
                <select id="addLcAgentSelect" style="padding: 4px 6px; border: 1px solid #93c5fd; border-radius: 4px; background: white; font-size: 11px; color: #333; min-width: 100px;">
                  <option value="">+ Add</option>
                </select>
                <button type="button" onclick="addLcAgent()" style="padding: 4px 8px; background: #3b82f6; color: white; border: none; border-radius: 4px; font-size: 10px; cursor: pointer;">Add</button>
              </div>
            </div>
            <div id="lcAgentsContainer" style="display: flex; flex-wrap: wrap; gap: 4px; min-height: 24px;">
              <span style="color: #64748b; font-size: 10px; font-style: italic;">None assigned</span>
            </div>
          </div>
        </div>
        
        <!-- All Hands PTO Section (conditional) -->
        <div id="allHandsPtoSection" style="display: none; background: #fce7f3; padding: 10px; border-radius: 8px; margin-bottom: 14px; border-left: 3px solid #ec4899;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
            <div style="font-size: 11px; font-weight: 600; color: #9d174d;">üéÅ PTO Credit <span style="font-weight: 400;">(+1hr for staying late)</span></div>
            <div style="display: flex; gap: 4px;">
              <select id="addPtoAgentSelect" style="padding: 4px 6px; border: 1px solid #f9a8d4; border-radius: 4px; background: white; font-size: 11px; min-width: 100px;">
                <option value="">+ Add</option>
              </select>
              <button type="button" onclick="addPtoAgent()" style="padding: 4px 8px; background: #ec4899; color: white; border: none; border-radius: 4px; font-size: 10px; cursor: pointer;">Add</button>
            </div>
          </div>
          <div id="allHandsPtoAgents" style="display: flex; flex-wrap: wrap; gap: 4px; min-height: 24px;">
            <span style="color: #64748b; font-size: 10px; font-style: italic;">None</span>
          </div>
        </div>
        
        <!-- Collapsible Sections -->
        <details style="margin-bottom: 10px;">
          <summary style="cursor: pointer; font-size: 12px; font-weight: 600; color: var(--text-secondary); padding: 8px; background: var(--bg-tertiary); border-radius: 6px;">üìä Fairness Stats (who's missed most meetings)</summary>
          <div id="fairnessStats" style="padding: 10px; font-size: 11px; background: var(--bg-secondary); border-radius: 0 0 6px 6px; max-height: 150px; overflow-y: auto;">
            <div style="color: var(--text-secondary);">Loading...</div>
          </div>
        </details>
        
        <details>
          <summary style="cursor: pointer; font-size: 12px; font-weight: 600; color: var(--text-secondary); padding: 8px; background: var(--bg-tertiary); border-radius: 6px;">üìú Recent Rotations</summary>
          <div id="rotationHistory" style="padding: 10px; font-size: 11px; background: var(--bg-secondary); border-radius: 0 0 6px 6px; max-height: 120px; overflow-y: auto;">
            <div style="color: var(--text-secondary);">Loading...</div>
          </div>
        </details>
      </div>
      
      <!-- Sticky Footer -->
      <div class="mFoot" style="flex-shrink: 0; border-top: 1px solid var(--border-color);">
        <button type="button" class="btn ghost" onclick="closeMeetingRotationModal()">Cancel</button>
        <button type="button" class="btn primary" onclick="saveRotation()">üíæ Save</button>
      </div>
    </div>
  </div>

  <!-- Weekly Assignments Modal (Redesigned) -->
  <div id="weeklyAssignmentsModal" class="overlay" style="display:none;" onclick="if(event.target===this) closeWeeklyAssignmentsModal()">
    <div class="modal" style="width: 550px; max-height: 85vh; display: flex; flex-direction: column; overflow: hidden;">
      <!-- Sticky Header -->
      <div class="mHead" style="flex-shrink: 0; position: sticky; top: 0; z-index: 10;">
        <span class="mTitle">üéØ Weekly Assignments</span>
        <button type="button" class="btn ghost" style="font-size: 18px; padding: 4px 10px;" onclick="closeWeeklyAssignmentsModal()">‚úï</button>
      </div>
      
      <!-- Scrollable Body -->
      <div class="mBody" style="overflow-y: auto; flex: 1; padding: 16px;">
        <!-- Week Selector -->
        <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border-color);">
          <label style="font-size: 12px; color: var(--text-secondary); white-space: nowrap;">Week of:</label>
          <input type="date" id="weeklyAssignmentDate" style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--input-bg); color: var(--text-primary); font-size: 12px;" onchange="loadWeeklyAssignments()">
        </div>
        
        <!-- LC Sync Presentations Section -->
        <div style="background: var(--bg-tertiary); border-radius: 10px; padding: 14px; margin-bottom: 14px;">
          <div style="font-weight: 700; font-size: 12px; margin-bottom: 12px; color: var(--text-primary);">üé§ LC Sync Presentations</div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <!-- LC Team Member Tips (presented during LC Syncs) -->
            <div style="background: #dbeafe; padding: 10px; border-radius: 8px; border: 1px solid #93c5fd; border-left: 3px solid #3b82f6;">
              <div style="font-size: 10px; font-weight: 600; color: #1e40af; margin-bottom: 4px;">üì¢ LC Team Member Tips</div>
              <div style="font-size: 9px; color: #64748b; margin-bottom: 6px; font-style: italic;">Presented during LC Syncs</div>
              <select id="weeklyLcTips1" style="width: 100%; padding: 6px; border: 1px solid #93c5fd; border-radius: 4px; background: white; font-size: 11px; color: #333; margin-bottom: 4px;">
                <option value="">Person 1</option>
              </select>
              <select id="weeklyLcTips2" style="width: 100%; padding: 6px; border: 1px solid #93c5fd; border-radius: 4px; background: white; font-size: 11px; color: #333;">
                <option value="">Person 2</option>
              </select>
            </div>
            
            <!-- Team Member Tips (regular tips) -->
            <div style="background: #fef3c7; padding: 10px; border-radius: 8px; border: 1px solid #fcd34d; border-left: 3px solid #f59e0b;">
              <div style="font-size: 10px; font-weight: 600; color: #92400e; margin-bottom: 4px;">üé§ Team Member Tips</div>
              <div style="font-size: 9px; color: #64748b; margin-bottom: 6px; font-style: italic;">Regular meeting tips</div>
              <select id="weeklyTips1" style="width: 100%; padding: 6px; border: 1px solid #fcd34d; border-radius: 4px; background: white; font-size: 11px; color: #333; margin-bottom: 4px;">
                <option value="">Person 1</option>
              </select>
              <select id="weeklyTips2" style="width: 100%; padding: 6px; border: 1px solid #fcd34d; border-radius: 4px; background: white; font-size: 11px; color: #333;">
                <option value="">Person 2</option>
              </select>
            </div>
            
            <!-- Moments That Made Me Smile (single person) -->
            <div style="background: var(--bg-secondary); padding: 10px; border-radius: 8px; border: 1px solid var(--border-color);">
              <div style="font-size: 10px; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">üòä Moments That Made Me Smile</div>
              <select id="weeklyMoments" style="width: 100%; padding: 6px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--input-bg); font-size: 11px; color: var(--text-primary);">
                <option value="">-- Select --</option>
              </select>
            </div>
            
            <!-- Ticket Walkthroughs -->
            <div style="background: var(--bg-secondary); padding: 10px; border-radius: 8px; border: 1px solid var(--border-color);">
              <div style="font-size: 10px; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">üé´ Ticket Walkthroughs</div>
              <select id="weeklyWalkthroughs" style="width: 100%; padding: 6px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--input-bg); font-size: 11px; color: var(--text-primary);">
                <option value="">-- Select --</option>
              </select>
            </div>
            
            <!-- CSAT Workshop -->
            <div style="background: var(--bg-secondary); padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); grid-column: span 2;">
              <div style="font-size: 10px; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">üìà CSAT Workshop</div>
              <select id="weeklyCsatWorkshop" style="width: 100%; padding: 6px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--input-bg); font-size: 11px; color: var(--text-primary);">
                <option value="">-- Select --</option>
              </select>
            </div>
          </div>
        </div>
        
        <!-- Team Building -->
        <div style="background: var(--bg-tertiary); border-radius: 10px; padding: 14px; margin-bottom: 14px;">
          <div style="font-weight: 700; font-size: 12px; margin-bottom: 10px; color: var(--text-primary);">üèóÔ∏è Team Building</div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div>
              <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px;">Lead</div>
              <select id="weeklyTeamBuilding" style="width: 100%; padding: 6px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--input-bg); font-size: 11px; color: var(--text-primary);">
                <option value="">-- Select --</option>
              </select>
            </div>
            <div>
              <div style="font-size: 10px; color: var(--text-secondary); margin-bottom: 4px;">Volunteer</div>
              <select id="weeklyVolunteer" style="width: 100%; padding: 6px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--input-bg); font-size: 11px; color: var(--text-primary);">
                <option value="">-- Select --</option>
              </select>
            </div>
          </div>
        </div>
        
        <!-- Special Events -->
        <div style="margin-bottom: 14px;">
          <div style="font-size: 11px; color: var(--text-secondary); margin-bottom: 4px;">üìÜ Special Events This Week</div>
          <input type="text" id="weeklyEvents" placeholder="e.g., Thursday & All Hands, Social Segment" style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 6px; background: var(--input-bg); font-size: 12px; color: var(--text-primary);">
        </div>
        
        <!-- History (Collapsible) -->
        <details>
          <summary style="cursor: pointer; font-size: 12px; font-weight: 600; color: var(--text-secondary); padding: 8px; background: var(--bg-tertiary); border-radius: 6px;">üìú Recent Weeks</summary>
          <div id="weeklyAssignmentHistory" style="padding: 10px; font-size: 11px; background: var(--bg-secondary); border-radius: 0 0 6px 6px; max-height: 100px; overflow-y: auto;">
            <div style="color: var(--text-secondary);">Loading...</div>
          </div>
        </details>
      </div>
      
      <!-- Sticky Footer -->
      <div class="mFoot" style="flex-shrink: 0; border-top: 1px solid var(--border-color);">
        <button type="button" class="btn ghost" onclick="closeWeeklyAssignmentsModal()">Cancel</button>
        <button type="button" class="btn primary" onclick="saveWeeklyAssignments()">üíæ Save</button>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Notifications Panel (NOT inside any overlay/div) -->
  <div id="notifPanel"
       style="display:none; position:fixed; top:74px; right:20px; width:360px; background:#fff; border:1px solid #e2e8f0; box-shadow:0 10px 25px rgba(0,0,0,0.1); border-radius:16px; z-index:3001; overflow:hidden;"
       onclick="event.stopPropagation()">
    <div class="mHead">
      <span class="mTitle">Notifications</span>
      <div style="display:flex; gap:8px;">
        <button type="button" class="btn ghost" style="padding:4px 8px; font-size:11px;" onclick="loadPendingNotifications()" title="Refresh">üîÑ</button>
        <button type="button" class="btn ghost" style="padding:4px 8px; font-size:11px;" onclick="clearNotifications()">Clear</button>
        <button type="button" class="btn primary" style="padding:4px 8px; font-size:11px;" onclick="sendAllPending()">Send</button>
      </div>
    </div>
    <div id="notifList" style="max-height:300px; overflow-y:auto; padding:10px;"></div>
  </div>
  <div id="toastHost"></div>
  <div id="loader" class="hidden"></div>
  <!-- My Profile / Balance Modal -->
<div id="balanceModal" class="overlay" style="display:none;" onclick="if(event.target===this) closeBalanceModal()">
  <div class="modal" style="width: 550px; max-height: 90vh; display: flex; flex-direction: column;">
    <div class="mHead" style="background: linear-gradient(135deg, #b37e78 0%, #8f5f5a 100%); border-bottom: none; flex-shrink: 0;">
      <span id="balanceModalTitle" class="mTitle" style="color: white;">üë§ My Profile</span>
      <button type="button" class="btn ghost" style="padding:6px 12px; color:white; background:rgba(255,255,255,0.15); border:1px solid rgba(255,255,255,0.25);" onclick="closeBalanceModal()">‚úï</button>
    </div>
    
    <div class="mBody" style="flex: 1; overflow-y: auto; max-height: calc(90vh - 60px);">
      <!-- Agent View - My Profile Dashboard -->
      <div id="agentBalanceView" style="display:none;">
        <!-- PTO Balance Card -->
        <div class="profile-section">
          <div class="profile-section-header">
            <span class="section-icon">üèñÔ∏è</span>
            <span class="section-title">Time Off Balance</span>
          </div>
          <div class="agent-pto-hero">
            <div class="pto-ring">
              <svg viewBox="0 0 100 100">
                <circle class="pto-ring-bg" cx="50" cy="50" r="45"/>
                <circle class="pto-ring-fill" cx="50" cy="50" r="45" id="ptoRingFill"/>
              </svg>
              <div class="pto-ring-content">
                <div class="pto-value" id="agentPtoBalance">--</div>
                <div class="pto-label">hours</div>
              </div>
            </div>
            <div class="pto-hero-info">
              <div class="pto-hero-title">Available PTO</div>
              <div class="pto-hero-subtitle">Use the "Request Time Off" button in the toolbar</div>
            </div>
          </div>
        </div>
        
        <!-- Zendesk Performance Section -->
        <div class="profile-section">
          <div class="profile-section-header">
            <span class="section-icon">üìä</span>
            <span class="section-title">Open Tickets</span>
          </div>
          <!-- Open tickets count with clickable list -->
          <div id="agentTicketsContainer">
            <div class="agent-stat-card" style="flex-direction: column; align-items: stretch;">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                <div class="agent-stat-icon" style="background: linear-gradient(135deg, #b37e78 0%, #8f5f5a 100%); width: 40px; height: 40px;">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px;">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                  </svg>
                </div>
                <div>
                  <div class="agent-stat-value" id="agentZendeskOpens" style="font-size: 24px;">--</div>
                  <div class="agent-stat-label">Open Tickets</div>
                </div>
              </div>
              <!-- Clickable ticket list -->
              <div id="agentTicketsList" style="max-height: 200px; overflow-y: auto; display: none;">
                <!-- Populated by JS -->
              </div>
              <div id="agentTicketsLoading" style="text-align: center; color: var(--text-secondary); font-size: 12px; padding: 8px;">
                Loading tickets...
              </div>
              <div id="agentTicketsEmpty" style="text-align: center; color: var(--text-tertiary); font-size: 12px; padding: 8px; display: none;">
                üéâ No open tickets!
              </div>
            </div>
          </div>
          <div style="margin-top: 10px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; font-size: 11px; color: var(--text-secondary);">
            üí° <strong>Tip:</strong> For detailed metrics (CSAT, solved by hour), check <a href="https://musely.zendesk.com/explore" target="_blank" style="color: var(--accent-primary);">Zendesk Explore</a>
          </div>
        </div>
        
        <!-- Schedule Stats -->
        <div class="profile-section">
          <div class="profile-section-header">
            <span class="section-icon">üìÖ</span>
            <span class="section-title">Schedule Overview</span>
          </div>
          <div class="agent-stats-grid">
            <div class="agent-stat-card">
              <div class="agent-stat-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%);">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <polyline points="12 6 12 12 16 14"/>
                </svg>
              </div>
              <div class="agent-stat-info">
                <div class="agent-stat-value" id="agentNextShift">--</div>
                <div class="agent-stat-label">Next Shift</div>
              </div>
            </div>
            <div class="agent-stat-card">
              <div class="agent-stat-icon" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                  <line x1="16" y1="2" x2="16" y2="6"/>
                  <line x1="8" y1="2" x2="8" y2="6"/>
                  <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
              </div>
              <div class="agent-stat-info">
                <div class="agent-stat-value" id="agentUpcomingShifts">--</div>
                <div class="agent-stat-label">Shifts This Week</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Weekly Assignments Section (for agents) -->
        <div class="profile-section" id="agentWeeklyAssignmentsSection" style="display: none;">
          <div class="profile-section-header">
            <span class="section-icon">üéØ</span>
            <span class="section-title">Your Assignments</span>
          </div>
          <div id="agentWeeklyAssignments" style="font-size: 13px;">
            <div style="color: var(--text-secondary);">Loading...</div>
          </div>
        </div>
        
        <!-- Sign Out Section -->
        <div class="profile-section" style="margin-top: 8px; padding-top: 16px; border-top: 1px dashed var(--border-color);">
          <button onclick="handleLogout()" class="sign-out-btn">
            üö™ Sign Out
          </button>
        </div>
      </div>
      
      <!-- Manager View -->
      <div id="managerBalanceView" style="display:none;">
        <div class="balanceTopRow">
  <input type="text" id="balanceSearch" class="fieldInput" placeholder="Search agent‚Ä¶" oninput="renderBalanceList()" />
  <button type="button" class="btn ghost" onclick="openBulkPtoModal()" title="Bulk add PTO to all agents">‚ûï Bulk Add</button>
</div>
<div class="bulkHint">Tip: use <strong>Bulk Add</strong> for team meetings, company events, or bonus time.</div>

        
        <div id="balanceList" style="max-height: 400px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px;">
          <!-- Will be populated by JS -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Bulk PTO Modal -->
<div id="bulkPtoModal" class="overlay overlay-sub" style="display:none;" onclick="if(event.target===this) closeBulkPtoModal()">
  <div class="modal bulkModal">
    <div class="mHead bulkHead">
      <div class="bulkHeadLeft">
        <div class="bulkHeadIcon">‚ûï</div>
        <div>
          <div class="mTitle" style="color:white;">Bulk Add PTO</div>
          <div class="bulkSubtitle">Add the same hours to every active agent.</div>
        </div>
      </div>
      <button type="button" class="iconClose light" onclick="closeBulkPtoModal()" aria-label="Close">‚úï</button>
    </div>

    <div class="mBody bulkBody">
      <div class="bulkInfo">
        <div class="bulkInfoTitle">Heads up</div>
        <div class="bulkInfoText">This will update each agent‚Äôs PTO balance and log an audit entry.</div>
      </div>

      <div class="bulkForm">
        <div class="bulkRow">
          <label class="fieldLabel" for="bulkPtoHours">Hours to add</label>
          <input id="bulkPtoHours" type="number" min="0.25" step="0.25" value="1" class="fieldInput" />
        </div>

        <div class="bulkRow">
          <label class="fieldLabel" for="bulkPtoReason">Reason (optional)</label>
          <input id="bulkPtoReason" type="text" placeholder="e.g., Team meeting" class="fieldInput" />
        </div>

        <div class="bulkMeta">
          <span>Applies to: <strong id="bulkPtoAgentCount">0</strong> agents</span>
        </div>

        <div class="bulkActions">
          <button type="button" class="btn ghost" onclick="closeBulkPtoModal()">Cancel</button>
          <button type="button" class="btn primary" onclick="applyBulkPto()">Add to all</button>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Agent Overlay - REDESIGNED -->
<div id="agentOverlay" class="overlay" style="display:none;" onclick="if(event.target===this) closeAgentModal()">
  <div class="modal agent-shift-modal">
    <!-- Modern Header -->
    <div class="agent-modal-header">
      <div class="agent-modal-header-content">
        <div class="agent-modal-icon">üìÖ</div>
        <div>
          <div class="agent-modal-title">Shift Details</div>
          <div class="agent-modal-subtitle">Manage your upcoming shift</div>
        </div>
      </div>
      <button type="button" class="agent-modal-close" onclick="closeAgentModal()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    
    <div class="agent-modal-body">
      <!-- Shift Info Card -->
      <div class="shift-info-card" id="agShiftDetailsCard">
        <div class="shift-info-date" id="agShiftDate">--</div>
        <div class="shift-info-time" id="agShiftTime">--</div>
        <div class="shift-info-team" id="agShiftTeam">--</div>
      </div>
      
      <!-- Action Buttons -->
      <div id="agActionSelect" class="agent-action-list">
        <button class="agent-shift-action" onclick="showAgentForm('swap')">
          <div class="action-icon-wrapper swap">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 3l4 4-4 4"/>
              <path d="M20 7H4"/>
              <path d="M8 21l-4-4 4-4"/>
              <path d="M4 17h16"/>
            </svg>
          </div>
          <div class="action-content">
            <div class="action-title">Swap or Give Away</div>
            <div class="action-desc">Trade this shift with a teammate</div>
          </div>
          <svg class="action-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"/>
          </svg>
        </button>
        
        <!-- Info hint about time off -->
        <div class="shift-modal-hint">
          <span class="hint-icon">üí°</span>
          <span class="hint-text">Need time off? Use the <strong>"Request Time Off"</strong> button in the toolbar above your schedule.</span>
        </div>
      </div>
      
      <!-- Swap Form (Hidden by Default) -->
      <div id="agFormSwap" style="display:none;" class="agent-form-section">
        <div class="form-group">
          <label class="form-label">Select Teammate</label>
          <select id="agSwapPerson" class="form-select"></select>
        </div>
        <div class="form-group">
          <label class="form-label">Add a Note (Optional)</label>
          <input type="text" id="agSwapNote" placeholder="e.g., Thanks for covering!" class="form-input">
        </div>
        <div class="form-actions">
          <button class="btn-back" onclick="resetAgentModal()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;">
              <polyline points="15 18 9 12 15 6"/>
            </svg>
            Back
          </button>
          <button class="btn-submit" onclick="submitSwap()">
            Send Request
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px;">
              <line x1="22" y1="2" x2="11" y2="13"/>
              <polygon points="22 2 15 22 11 13 2 9 22 2"/>
            </svg>
          </button>
        </div>
      </div>
    
      <!-- Time Off Form (Hidden by Default) -->
      <div id="agFormTimeOff" style="display:none; animation: slideIn 0.3s ease;">
        
        <!-- Compact PTO Balance Display - Single Column -->
        <div style="display:flex; justify-content:center; margin-bottom:16px;">
          <div style="text-align:center; padding:14px 32px; background:linear-gradient(135deg, #faf5f4 0%, #f0e6e4 100%); border-radius:12px; border:2px solid #86efac;">
            <div style="font-size:10px; font-weight:700; color:#15803d; text-transform:uppercase; letter-spacing:0.5px;">PTO Balance</div>
            <div id="agPtoHours" style="font-size:28px; font-weight:900; color:#16a34a;">--</div>
            <div style="font-size:10px; color:#22c55e;">hours available</div>
          </div>
        </div>
        <!-- Type Selection - Compact Cards -->
        <div style="margin-bottom:16px;">
          <label style="display:block; font-size:11px; font-weight:700; color:#64748b; margin-bottom:8px; text-transform:uppercase;">Type</label>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
            <label class="type-card" onclick="this.querySelector('input').checked=true; updateTypeSelection();" style="display:flex; align-items:center; gap:10px; padding:12px; border:2px solid #b37e78; border-radius:10px; cursor:pointer; background:#fbf6f5; transition:all 0.2s;">
              <input type="radio" name="timeOffType" value="Make Up" checked style="width:16px; height:16px; accent-color:#b37e78;" onchange="updateTypeSelection()">
              <div>
                <div style="font-size:13px; font-weight:600; color:#1e293b;">üîÑ MAKE UP</div>
                <div style="font-size:10px; color:#64748b;">Work another time</div>
              </div>
            </label>
            <label class="type-card" onclick="this.querySelector('input').checked=true; updateTypeSelection();" style="display:flex; align-items:center; gap:10px; padding:12px; border:2px solid #e2e8f0; border-radius:10px; cursor:pointer; background:#fff; transition:all 0.2s;">
              <input type="radio" name="timeOffType" value="PTO" style="width:16px; height:16px; accent-color:#16a34a;" onchange="updateTypeSelection()">
              <div>
                <div style="font-size:13px; font-weight:600; color:#1e293b;">üî• USE PTO</div>
                <div style="font-size:10px; color:#64748b;">Deduct hours</div>
              </div>
            </label>
          </div>
        </div>
        
        <!-- Time Duration Selection -->
        <div id="agTimeDurationWrap" style="margin-bottom:16px;">
          <label style="display:block; font-size:11px; font-weight:700; color:#64748b; margin-bottom:8px; text-transform:uppercase;">Time Off Duration</label>
          <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; margin-bottom:12px;">
            <label class="duration-card" onclick="this.querySelector('input').checked=true; updateDurationSelection();" style="display:flex; flex-direction:column; align-items:center; gap:4px; padding:10px; border:2px solid #e2e8f0; border-radius:8px; cursor:pointer; background:#fff; transition:all 0.2s;">
              <input type="radio" name="timeOffDuration" value="full_shift" checked style="width:14px; height:14px; accent-color:#3b82f6;" onchange="updateDurationSelection()">
              <div style="font-size:11px; font-weight:600; color:#1e293b; text-align:center;">Full Shift</div>
            </label>
            <label class="duration-card" onclick="this.querySelector('input').checked=true; updateDurationSelection();" style="display:flex; flex-direction:column; align-items:center; gap:4px; padding:10px; border:2px solid #e2e8f0; border-radius:8px; cursor:pointer; background:#fff; transition:all 0.2s;">
              <input type="radio" name="timeOffDuration" value="full_day" style="width:14px; height:14px; accent-color:#3b82f6;" onchange="updateDurationSelection()">
              <div style="font-size:11px; font-weight:600; color:#1e293b; text-align:center;">Full Day</div>
            </label>
            <label class="duration-card" onclick="this.querySelector('input').checked=true; updateDurationSelection();" style="display:flex; flex-direction:column; align-items:center; gap:4px; padding:10px; border:2px solid #e2e8f0; border-radius:8px; cursor:pointer; background:#fff; transition:all 0.2s;">
              <input type="radio" name="timeOffDuration" value="partial" style="width:14px; height:14px; accent-color:#3b82f6;" onchange="updateDurationSelection()">
              <div style="font-size:11px; font-weight:600; color:#1e293b; text-align:center;">Partial Day</div>
            </label>
          </div>
          
          <!-- Partial Time Selection (hidden by default) -->
          <div id="agPartialTimeWrap" style="display:none; padding:12px; background:#f8fafc; border-radius:8px; border:1px solid #e2e8f0;">
            <label style="display:block; font-size:10px; font-weight:700; color:#64748b; margin-bottom:6px; text-transform:uppercase;">Specify Time Range</label>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
              <div>
                <label style="display:block; font-size:10px; color:#64748b; margin-bottom:4px;">Start Time</label>
                <input type="time" id="agPartialStart" style="width:100%; padding:8px; border:1px solid #cbd5e1; border-radius:6px; font-size:13px; box-sizing:border-box;">
              </div>
              <div>
                <label style="display:block; font-size:10px; color:#64748b; margin-bottom:4px;">End Time</label>
                <input type="time" id="agPartialEnd" style="width:100%; padding:8px; border:1px solid #cbd5e1; border-radius:6px; font-size:13px; box-sizing:border-box;">
              </div>
            </div>
            <div id="agPartialHoursDisplay" style="margin-top:8px; font-size:11px; color:#475569; font-weight:600; text-align:center;"></div>
          </div>
        </div>
        
        <!-- Make Up Date(s) - supports multiple dates -->
        <div id="agMakeUpWrap" style="margin-bottom:16px;">
          <label style="display:block; font-size:11px; font-weight:700; color:#64748b; margin-bottom:6px; text-transform:uppercase;">Make Up Date(s)</label>
          <div style="display: flex; gap: 8px; margin-bottom: 8px;">
            <input type="date" id="agMakeUpDate" style="flex:1; padding:10px 12px; border:2px solid #e2e8f0; border-radius:8px; font-size:14px; box-sizing:border-box;">
            <button type="button" onclick="addMakeUpDate()" style="padding: 10px 16px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; white-space: nowrap;">+ Add</button>
          </div>
          <div id="makeUpDatesList" style="display: flex; flex-wrap: wrap; gap: 6px;"></div>
          
          <!-- Make Up Time Selection -->
          <div style="margin-top:10px; padding:12px; background:#f0fdf4; border-radius:8px; border:1px solid #bbf7d0;">
            <label style="display:block; font-size:10px; font-weight:700; color:#15803d; margin-bottom:6px; text-transform:uppercase;">Make Up Time</label>
            <div style="display:grid; grid-template-columns:1fr auto 1fr; gap:8px; align-items:center;">
              <div>
                <label style="display:block; font-size:10px; color:#64748b; margin-bottom:4px;">From</label>
                <select id="agMakeUpTimeStart" style="width:100%; padding:8px; border:1px solid #cbd5e1; border-radius:6px; font-size:12px; box-sizing:border-box; background:white;">
                  <option value="">Select time</option>
                  <option value="06:00">6:00 AM</option>
                  <option value="07:00">7:00 AM</option>
                  <option value="08:00">8:00 AM</option>
                  <option value="09:00">9:00 AM</option>
                  <option value="10:00">10:00 AM</option>
                  <option value="11:00">11:00 AM</option>
                  <option value="12:00">12:00 PM</option>
                  <option value="13:00">1:00 PM</option>
                  <option value="14:00">2:00 PM</option>
                  <option value="15:00">3:00 PM</option>
                  <option value="16:00">4:00 PM</option>
                  <option value="17:00">5:00 PM</option>
                  <option value="18:00">6:00 PM</option>
                  <option value="19:00">7:00 PM</option>
                  <option value="20:00">8:00 PM</option>
                  <option value="21:00">9:00 PM</option>
                  <option value="22:00">10:00 PM</option>
                </select>
              </div>
              <div style="color:#15803d; font-weight:600; padding-top:18px;">‚Üí</div>
              <div>
                <label style="display:block; font-size:10px; color:#64748b; margin-bottom:4px;">Until</label>
                <select id="agMakeUpTimeEnd" style="width:100%; padding:8px; border:1px solid #cbd5e1; border-radius:6px; font-size:12px; box-sizing:border-box; background:white;">
                  <option value="">Select time</option>
                  <option value="07:00">7:00 AM</option>
                  <option value="08:00">8:00 AM</option>
                  <option value="09:00">9:00 AM</option>
                  <option value="10:00">10:00 AM</option>
                  <option value="11:00">11:00 AM</option>
                  <option value="12:00">12:00 PM</option>
                  <option value="13:00">1:00 PM</option>
                  <option value="14:00">2:00 PM</option>
                  <option value="15:00">3:00 PM</option>
                  <option value="16:00">4:00 PM</option>
                  <option value="17:00">5:00 PM</option>
                  <option value="18:00">6:00 PM</option>
                  <option value="19:00">7:00 PM</option>
                  <option value="20:00">8:00 PM</option>
                  <option value="21:00">9:00 PM</option>
                  <option value="22:00">10:00 PM</option>
                </select>
              </div>
            </div>
            <div id="agMakeUpHoursCalc" style="text-align:center; margin-top:6px; font-size:11px; color:#15803d; font-weight:600;"></div>
          </div>
          
          <div style="font-size: 10px; color: #94a3b8; margin-top: 6px;">üí° Add multiple dates if you need to spread make-up time across several days</div>
        </div>
        <!-- Reason -->
        <div style="margin-bottom:16px;">
          <label style="display:block; font-size:11px; font-weight:700; color:#64748b; margin-bottom:6px; text-transform:uppercase;">Reason</label>
          <input type="text" id="agToReason" placeholder="e.g., Sick, Appointment..." style="width:100%; padding:10px 12px; border:2px solid #e2e8f0; border-radius:8px; font-size:14px; box-sizing:border-box;">
        </div>
        <!-- Actions -->
        <div style="display:flex; gap:10px;">
          <button class="btn ghost" onclick="resetAgentModal()" style="flex:1; padding:12px;">‚Üê Back</button>
          <button onclick="submitTimeOff()" style="flex:2; background:linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color:white; border:none; border-radius:10px; padding:12px; font-weight:700; cursor:pointer;">
            Submit Request ‚Üí
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

</div>


<!-- Future Time Off Request Modal (for agents) -->
<div id="futureTimeOffModal" style="
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  z-index: 15000;
  justify-content: center;
  align-items: center;
">
  <div style="
    background: white;
    border-radius: 20px;
    width: 480px;
    max-width: 95%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 25px 80px rgba(0,0,0,0.35);
  ">
    <!-- Header -->
    <div style="
      padding:20px 24px; 
      background: linear-gradient(135deg, #b37e78 0%, #8f5f5a 100%);
      border-radius: 20px 20px 0 0;
      display:flex; 
      justify-content:space-between; 
      align-items:center;
    ">
      <div style="font-weight:700; font-size:18px; color:white;">üìÖ Request Time Off</div>
      <button onclick="closeFutureTimeOffModal()" style="background:rgba(255,255,255,0.2); border:none; font-size:18px; cursor:pointer; color:white; width:32px; height:32px; border-radius:8px;">&times;</button>
    </div>
    
    <div style="padding:24px;">
      <!-- PTO Balance Display -->
      <div id="futureTimeOffPtoDisplay" style="
        display:flex; 
        justify-content:center; 
        margin-bottom:20px;
        padding:16px;
        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        border-radius:12px;
        border:2px solid #86efac;
      ">
        <div style="text-align:center;">
          <div style="font-size:11px; font-weight:700; color:#15803d; text-transform:uppercase; letter-spacing:0.5px;">Your PTO Balance</div>
          <div id="futureTimeOffPtoAmount" style="font-size:32px; font-weight:900; color:#16a34a;">--</div>
          <div style="font-size:11px; color:#22c55e;">hours available</div>
        </div>
      </div>
      
      <!-- Duration Toggle: Full Day vs Partial Day -->
      <div style="margin-bottom:20px;">
        <label style="display:block; font-size:12px; font-weight:700; color:#64748b; margin-bottom:8px; text-transform:uppercase;">Duration</label>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
          <label id="futureDurationFull" onclick="selectFutureTimeOffDuration('full')" style="
            display:flex; 
            align-items:center; 
            gap:10px; 
            padding:12px; 
            border:2px solid #b37e78; 
            border-radius:12px; 
            cursor:pointer;
            background:#fbf6f5;
            transition: all 0.2s;
          ">
            <input type="radio" name="futureToDuration" value="full_day" checked style="width:16px; height:16px; accent-color:#b37e78;">
            <div>
              <div style="font-size:13px; font-weight:700; color:#8f5f5a;">üìÖ Full Day</div>
              <div style="font-size:10px; color:#b37e78;">Entire shift off</div>
            </div>
          </label>
          <label id="futureDurationPartial" onclick="selectFutureTimeOffDuration('partial')" style="
            display:flex; 
            align-items:center; 
            gap:10px; 
            padding:12px; 
            border:2px solid #e2e8f0; 
            border-radius:12px; 
            cursor:pointer;
            background:white;
            transition: all 0.2s;
          ">
            <input type="radio" name="futureToDuration" value="partial" style="width:16px; height:16px; accent-color:#7c3aed;">
            <div>
              <div style="font-size:13px; font-weight:700; color:#1e293b;">‚è∞ Partial Day</div>
              <div style="font-size:10px; color:#64748b;">Leave early / come late</div>
            </div>
          </label>
        </div>
      </div>
      
      <!-- Partial Day Time Selection (hidden by default) -->
      <div id="futurePartialWrap" style="display:none; margin-bottom:20px;">
        <label style="display:block; font-size:12px; font-weight:700; color:#7c3aed; margin-bottom:8px; text-transform:uppercase;">Hours Off</label>
        <div style="
          padding:16px;
          background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
          border-radius:12px;
          border:2px solid #c4b5fd;
        ">
          <div style="display:grid; grid-template-columns:1fr auto 1fr; gap:10px; align-items:center;">
            <div>
              <label style="font-size:10px; color:#7c3aed; display:block; margin-bottom:4px; font-weight:600;">Off From</label>
              <select id="futurePartialStart" style="
                width:100%; 
                padding:10px; 
                border:2px solid #c4b5fd; 
                border-radius:10px; 
                font-size:13px;
                background:white;
                box-sizing:border-box;
              ">
                <option value="">Select time</option>
                <option value="06:00">6:00 AM</option>
                <option value="07:00">7:00 AM</option>
                <option value="08:00">8:00 AM</option>
                <option value="09:00">9:00 AM</option>
                <option value="10:00">10:00 AM</option>
                <option value="11:00">11:00 AM</option>
                <option value="12:00">12:00 PM</option>
                <option value="13:00">1:00 PM</option>
                <option value="14:00">2:00 PM</option>
                <option value="15:00">3:00 PM</option>
                <option value="16:00">4:00 PM</option>
                <option value="17:00">5:00 PM</option>
                <option value="18:00">6:00 PM</option>
                <option value="19:00">7:00 PM</option>
                <option value="20:00">8:00 PM</option>
                <option value="21:00">9:00 PM</option>
                <option value="22:00">10:00 PM</option>
              </select>
            </div>
            <div style="color:#7c3aed; font-weight:600; padding-top:20px;">‚Üí</div>
            <div>
              <label style="font-size:10px; color:#7c3aed; display:block; margin-bottom:4px; font-weight:600;">Off Until</label>
              <select id="futurePartialEnd" style="
                width:100%; 
                padding:10px; 
                border:2px solid #c4b5fd; 
                border-radius:10px; 
                font-size:13px;
                background:white;
                box-sizing:border-box;
              ">
                <option value="">Select time</option>
                <option value="07:00">7:00 AM</option>
                <option value="08:00">8:00 AM</option>
                <option value="09:00">9:00 AM</option>
                <option value="10:00">10:00 AM</option>
                <option value="11:00">11:00 AM</option>
                <option value="12:00">12:00 PM</option>
                <option value="13:00">1:00 PM</option>
                <option value="14:00">2:00 PM</option>
                <option value="15:00">3:00 PM</option>
                <option value="16:00">4:00 PM</option>
                <option value="17:00">5:00 PM</option>
                <option value="18:00">6:00 PM</option>
                <option value="19:00">7:00 PM</option>
                <option value="20:00">8:00 PM</option>
                <option value="21:00">9:00 PM</option>
                <option value="22:00">10:00 PM</option>
                <option value="end">End of shift</option>
              </select>
            </div>
          </div>
          <div id="futurePartialHoursCalc" style="text-align:center; margin-top:10px; font-size:12px; color:#7c3aed; font-weight:600;"></div>
        </div>
      </div>
      
      <!-- Date Range Selection -->
      <div style="margin-bottom:20px;">
        <label style="display:block; font-size:12px; font-weight:700; color:#64748b; margin-bottom:8px; text-transform:uppercase;">Date Range</label>
        <div id="futureDateRangeGrid" style="display:grid; grid-template-columns:1fr auto 1fr; gap:10px; align-items:center;">
          <div>
            <label style="font-size:10px; color:#94a3b8; display:block; margin-bottom:4px;">Start Date</label>
            <input type="date" id="futureToDateStart" style="
              width:100%; 
              padding:12px; 
              border:2px solid #e2e8f0; 
              border-radius:10px; 
              font-size:14px;
              box-sizing:border-box;
            ">
          </div>
          <div id="futureDateArrow" style="color:#94a3b8; font-weight:600; padding-top:20px;">‚Üí</div>
          <div id="futureDateEndWrap">
            <label style="font-size:10px; color:#94a3b8; display:block; margin-bottom:4px;">End Date</label>
            <input type="date" id="futureToDateEnd" style="
              width:100%; 
              padding:12px; 
              border:2px solid #e2e8f0; 
              border-radius:10px; 
              font-size:14px;
              box-sizing:border-box;
            ">
          </div>
        </div>
        <div id="futureTimeOffDaysCount" style="text-align:center; margin-top:8px; font-size:12px; color:#64748b;"></div>
      </div>
      
      <!-- Type Selection -->
      <div style="margin-bottom:20px;">
        <label style="display:block; font-size:12px; font-weight:700; color:#64748b; margin-bottom:8px; text-transform:uppercase;">Type</label>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
          <label id="futureTypeMakeUp" onclick="selectFutureTimeOffType('makeup')" style="
            display:flex; 
            align-items:center; 
            gap:10px; 
            padding:14px; 
            border:2px solid #b37e78; 
            border-radius:12px; 
            cursor:pointer;
            background:#fbf6f5;
            transition: all 0.2s;
          ">
            <input type="radio" name="futureToType" value="Make Up" checked style="width:16px; height:16px; accent-color:#b37e78;">
            <div>
              <div style="font-size:14px; font-weight:700; color:#8f5f5a;">üîÑ MAKE UP</div>
              <div style="font-size:10px; color:#b37e78;">Work another time</div>
            </div>
          </label>
          <label id="futureTypePTO" onclick="selectFutureTimeOffType('pto')" style="
            display:flex; 
            align-items:center; 
            gap:10px; 
            padding:14px; 
            border:2px solid #e2e8f0; 
            border-radius:12px; 
            cursor:pointer;
            background:white;
            transition: all 0.2s;
          ">
            <input type="radio" name="futureToType" value="PTO" style="width:16px; height:16px; accent-color:#16a34a;">
            <div>
              <div style="font-size:14px; font-weight:700; color:#1e293b;">üî• USE PTO</div>
              <div style="font-size:10px; color:#64748b;">Deduct hours</div>
            </div>
          </label>
        </div>
      </div>
      
      <!-- Make Up Date(s) (conditional) - supports multiple dates -->
      <div id="futureToMakeUpWrap" style="margin-bottom:20px;">
        <label style="display:block; font-size:12px; font-weight:700; color:#64748b; margin-bottom:8px; text-transform:uppercase;">Make Up Date(s)</label>
        <div style="display:flex; gap:8px; margin-bottom:8px;">
          <input type="date" id="futureToMakeUpDate" style="
            flex:1; 
            padding:12px; 
            border:2px solid #e2e8f0; 
            border-radius:10px; 
            font-size:14px;
            box-sizing:border-box;
          ">
          <button type="button" onclick="addFutureMakeUpDate()" style="
            padding:12px 16px;
            background:linear-gradient(135deg, #b37e78 0%, #8f5f5a 100%);
            color:white;
            border:none;
            border-radius:10px;
            font-size:13px;
            font-weight:600;
            cursor:pointer;
            white-space:nowrap;
          ">+ Add Date</button>
        </div>
        <div id="futureMakeUpDatesList" style="display:flex; flex-wrap:wrap; gap:6px; min-height:24px;"></div>
        
        <!-- Make Up Time Selection -->
        <div style="margin-top:12px; padding:14px; background:linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius:12px; border:2px solid #86efac;">
          <label style="display:block; font-size:11px; font-weight:700; color:#15803d; margin-bottom:8px; text-transform:uppercase;">Make Up Time</label>
          <div style="display:grid; grid-template-columns:1fr auto 1fr; gap:10px; align-items:center;">
            <div>
              <label style="font-size:10px; color:#15803d; display:block; margin-bottom:4px; font-weight:600;">From</label>
              <select id="futureToMakeUpTimeStart" style="
                width:100%; 
                padding:10px; 
                border:2px solid #86efac; 
                border-radius:10px; 
                font-size:13px;
                background:white;
                box-sizing:border-box;
              ">
                <option value="">Select time</option>
                <option value="06:00">6:00 AM</option>
                <option value="07:00">7:00 AM</option>
                <option value="08:00">8:00 AM</option>
                <option value="09:00">9:00 AM</option>
                <option value="10:00">10:00 AM</option>
                <option value="11:00">11:00 AM</option>
                <option value="12:00">12:00 PM</option>
                <option value="13:00">1:00 PM</option>
                <option value="14:00">2:00 PM</option>
                <option value="15:00">3:00 PM</option>
                <option value="16:00">4:00 PM</option>
                <option value="17:00">5:00 PM</option>
                <option value="18:00">6:00 PM</option>
                <option value="19:00">7:00 PM</option>
                <option value="20:00">8:00 PM</option>
                <option value="21:00">9:00 PM</option>
                <option value="22:00">10:00 PM</option>
              </select>
            </div>
            <div style="color:#15803d; font-weight:600; padding-top:20px;">‚Üí</div>
            <div>
              <label style="font-size:10px; color:#15803d; display:block; margin-bottom:4px; font-weight:600;">Until</label>
              <select id="futureToMakeUpTimeEnd" style="
                width:100%; 
                padding:10px; 
                border:2px solid #86efac; 
                border-radius:10px; 
                font-size:13px;
                background:white;
                box-sizing:border-box;
              ">
                <option value="">Select time</option>
                <option value="07:00">7:00 AM</option>
                <option value="08:00">8:00 AM</option>
                <option value="09:00">9:00 AM</option>
                <option value="10:00">10:00 AM</option>
                <option value="11:00">11:00 AM</option>
                <option value="12:00">12:00 PM</option>
                <option value="13:00">1:00 PM</option>
                <option value="14:00">2:00 PM</option>
                <option value="15:00">3:00 PM</option>
                <option value="16:00">4:00 PM</option>
                <option value="17:00">5:00 PM</option>
                <option value="18:00">6:00 PM</option>
                <option value="19:00">7:00 PM</option>
                <option value="20:00">8:00 PM</option>
                <option value="21:00">9:00 PM</option>
                <option value="22:00">10:00 PM</option>
              </select>
            </div>
          </div>
          <div id="futureToMakeUpHoursCalc" style="text-align:center; margin-top:8px; font-size:12px; color:#15803d; font-weight:600;"></div>
        </div>
        
        <div style="font-size:11px; color:#64748b; margin-top:6px;">üìù Add one or more dates when you'll make up these hours</div>
      </div>
      
      <!-- Reason -->
      <div style="margin-bottom:24px;">
        <label style="display:block; font-size:12px; font-weight:700; color:#64748b; margin-bottom:8px; text-transform:uppercase;">Reason</label>
        <input type="text" id="futureToReason" placeholder="e.g., Vacation, Doctor's appointment, Family event..." style="
          width:100%; 
          padding:14px; 
          border:2px solid #e2e8f0; 
          border-radius:10px; 
          font-size:14px;
          box-sizing:border-box;
        ">
      </div>
      
      <!-- Submit -->
      <button onclick="submitFutureTimeOff()" style="
        width:100%;
        padding:16px;
        background:linear-gradient(135deg, #b37e78 0%, #8f5f5a 100%);
        color:white;
        border:none;
        border-radius:12px;
        font-size:15px;
        font-weight:700;
        cursor:pointer;
        transition: all 0.2s;
        box-shadow: 0 4px 12px rgba(179,126,120,0.3);
      " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 6px 16px rgba(179,126,120,0.4)';"
         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(179,126,120,0.3)';">
        Submit Request ‚Üí
      </button>
    </div>
  </div>
</div>
<!-- Agent Notification Panel -->
<div id="agentNotifPanel" style="
  display: none;
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  width: 380px;
  max-width: 100%;
  background: var(--bg-secondary, white);
  box-shadow: -4px 0 20px rgba(0,0,0,0.15);
  z-index: 10000;
  flex-direction: column;
">
  <div style="display:flex; justify-content:space-between; align-items:center; padding:20px; border-bottom:1px solid var(--border-color, #e2e8f0); background: var(--bg-primary);">
    <div style="font-weight:700; font-size:18px; color:var(--text-primary, #0f172a);">My Notifications</div>
    <div style="display:flex; gap:8px; align-items:center;">
      <button onclick="clearAgentNotifications()" style="background:var(--bg-tertiary); border:1px solid var(--border-color); padding:6px 12px; border-radius:6px; font-size:12px; font-weight:600; cursor:pointer; color:var(--text-secondary);">Clear All</button>
      <button onclick="closeAgentNotifications()" style="background:none; border:none; font-size:24px; cursor:pointer; color:var(--text-secondary);">&times;</button>
    </div>
  </div>
  <div id="agentNotifList" style="flex:1; overflow-y:auto; padding:12px; background: var(--bg-primary);"></div>
</div>


<!-- Agent Goals Panel -->
<div id="agentGoalsPanel">
  <div class="agent-goals-header">
    <div class="agent-goals-title">üéØ My Goals & Performance</div>
    <button class="agent-goals-close" onclick="toggleAgentGoalsPanel()">&times;</button>
  </div>
  <div class="agent-goals-content">
    <div class="agent-goals-tabs">
      <button class="agent-goals-tab active" data-tab="overview" onclick="switchAgentGoalsTab('overview')">üìã Overview</button>
      <button class="agent-goals-tab" data-tab="goals" onclick="switchAgentGoalsTab('goals')">üéØ My Goals</button>
      <button class="agent-goals-tab" data-tab="metrics" onclick="switchAgentGoalsTab('metrics')">üìä My Metrics</button>
      <button class="agent-goals-tab" data-tab="tasks" onclick="switchAgentGoalsTab('tasks')">üìù My Tasks</button>
    </div>
    
    <!-- Overview Section -->
    <div id="agentGoalsOverview" class="agent-goals-section active">
      <div class="agent-goals-cards">
        <div class="agent-stat-card">
          <div class="agent-stat-icon" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);">üéØ</div>
          <div class="agent-stat-value" id="agentActiveGoals">0</div>
          <div class="agent-stat-label">Active Goals</div>
          <div class="agent-stat-sub" id="agentGoalsDueSub">No goals due soon</div>
        </div>
        <div class="agent-stat-card">
          <div class="agent-stat-icon" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);">üìù</div>
          <div class="agent-stat-value" id="agentOpenTasks">0</div>
          <div class="agent-stat-label">Open Tasks</div>
          <div class="agent-stat-sub" id="agentTasksSub">None overdue</div>
        </div>
        <div class="agent-stat-card">
          <div class="agent-stat-icon" style="background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);">üìà</div>
          <div class="agent-stat-value" id="agentOpenTickets">--</div>
          <div class="agent-stat-label">Open Tickets</div>
          <div class="agent-stat-sub">Current workload</div>
        </div>
        <div class="agent-stat-card">
          <div class="agent-stat-icon" style="background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);">‚≠ê</div>
          <div class="agent-stat-value" id="agentWeeksTracked">0</div>
          <div class="agent-stat-label">Weeks Tracked</div>
          <div class="agent-stat-sub">Performance data</div>
        </div>
      </div>
      
      <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 18px; margin-bottom: 16px;">
        <div style="font-size: 13px; font-weight: 700; color: var(--text-primary); margin-bottom: 12px;">üì¢ Action Items</div>
        <div id="agentActionItems">
          <div style="padding: 12px; background: var(--bg-tertiary); border-radius: 8px; display: flex; align-items: center; gap: 10px; color: var(--text-secondary); font-size: 13px;">
            <span>‚ú®</span> All caught up! No urgent items.
          </div>
        </div>
      </div>
    </div>
    
    <!-- Goals Section -->
    <div id="agentGoalsGoals" class="agent-goals-section">
      <div id="agentGoalsList" class="agent-goals-list">
        <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
          <div style="font-size: 48px; margin-bottom: 12px;">üéØ</div>
          <div style="font-size: 14px;">No active goals yet.</div>
          <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 4px;">Check with your manager about your development goals.</div>
        </div>
      </div>
    </div>
    
    <!-- Metrics Section -->
    <div id="agentGoalsMetrics" class="agent-goals-section">
      <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 16px;">
        <div style="font-size: 14px; font-weight: 700; color: var(--text-primary); margin-bottom: 16px;">üìä Recent Performance Metrics</div>
        <div id="agentMetricsTable" style="overflow-x: auto;">
          <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
            <thead>
              <tr style="background: var(--bg-tertiary);">
                <th style="padding: 10px; text-align: left; font-weight: 700; border-bottom: 2px solid var(--border-color);">Week</th>
                <th style="padding: 10px; text-align: center; font-weight: 700; border-bottom: 2px solid var(--border-color);">Tickets</th>
                <th style="padding: 10px; text-align: center; font-weight: 700; border-bottom: 2px solid var(--border-color);">Handle Time</th>
                <th style="padding: 10px; text-align: center; font-weight: 700; border-bottom: 2px solid var(--border-color);">CSAT</th>
                <th style="padding: 10px; text-align: center; font-weight: 700; border-bottom: 2px solid var(--border-color);">LC CSAT</th>
              </tr>
            </thead>
            <tbody id="agentMetricsTableBody">
              <tr><td colspan="5" style="padding: 20px; text-align: center; color: var(--text-tertiary);">No metrics data available</td></tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- Bad CSAT Follow-ups Section -->
      <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 16px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <div style="font-size: 14px; font-weight: 700; color: var(--text-primary);">‚ö†Ô∏è Bad CSAT Follow-ups</div>
          <span id="agentBadCsatCount" style="font-size: 12px; color: var(--text-tertiary);">0 items</span>
        </div>
        <div id="agentBadCsatList">
          <div style="padding: 20px; text-align: center; color: var(--text-tertiary);">
            <div style="font-size: 32px; margin-bottom: 8px;">‚ú®</div>
            <div style="font-size: 13px;">No bad CSAT follow-ups</div>
            <div style="font-size: 12px; margin-top: 4px;">Keep up the great work!</div>
          </div>
        </div>
      </div>
      
      <div style="padding: 16px; background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 12px; border: 1px solid #93c5fd;">
        <div style="display: flex; align-items: center; gap: 10px; font-size: 13px; color: #1e40af;">
          <span>üí°</span>
          <span>For detailed CSAT analytics, visit <a href="https://musely.zendesk.com/explore" target="_blank" style="color: #2563eb; font-weight: 600;">Zendesk Explore</a></span>
        </div>
      </div>
    </div>
    
    <!-- Tasks Section -->
    <div id="agentGoalsTasks" class="agent-goals-section">
      <div id="agentTasksList" class="agent-goals-list">
        <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
          <div style="font-size: 48px; margin-bottom: 12px;">üìù</div>
          <div style="font-size: 14px;">No tasks assigned.</div>
          <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 4px;">Tasks from your manager will appear here.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Meeting Rotation Acknowledgment Modal -->
<div id="meetingRotationAckModal" style="
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.7);
  z-index: 20000;
  justify-content: center;
  align-items: center;
  backdrop-filter: blur(4px);
">
  <div style="
    background: white;
    border-radius: 20px;
    width: 440px;
    max-width: 95%;
    box-shadow: 0 25px 80px rgba(0,0,0,0.4);
    overflow: hidden;
    animation: slideIn 0.3s ease;
  ">
    <div style="
      padding: 24px;
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      text-align: center;
    ">
      <div style="font-size: 48px; margin-bottom: 8px;">üìÖ</div>
      <div style="font-size: 20px; font-weight: 800; color: white;">Meeting Rotation Alert!</div>
    </div>
    <div style="padding: 24px;">
      <div style="text-align: center; margin-bottom: 20px;">
        <div style="font-size: 15px; color: #334155; line-height: 1.6;" id="meetingAckMessage">
          You are assigned to an upcoming Thursday meeting rotation.
        </div>
      </div>
      <div id="meetingAckDetails" style="
        background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
        border: 2px solid #f59e0b;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 20px;
      ">
        <!-- Details populated by JS -->
      </div>
      <div style="font-size: 12px; color: #64748b; text-align: center; margin-bottom: 20px;">
        ‚ö†Ô∏è Please acknowledge this notification. It will appear each time you open the schedule until acknowledged.
      </div>
      <button onclick="acknowledgeMeetingRotation()" style="
        width: 100%;
        padding: 16px;
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
      ">
        ‚úì I Acknowledge
      </button>
    </div>
  </div>
</div>




<!-- Open Shifts Modal -->
<div id="openShiftsModal" class="overlay" style="display:none;" onclick="if(event.target===this) closeOpenShiftsModal()">
  <div class="modal" style="width:520px; max-width:95%; max-height:90vh; overflow:hidden; display:flex; flex-direction:column;">
    <div class="mHead" style="background:linear-gradient(135deg, var(--modal-gradient-start) 0%, var(--modal-gradient-end) 100%); border-bottom:none; flex-shrink:0;">
      <span class="mTitle" style="color:white;">üìã Open Shifts</span>
      <button type="button" class="btn ghost" style="padding:6px 12px; color:white; background:rgba(255,255,255,0.15); border:1px solid rgba(255,255,255,0.25);" onclick="closeOpenShiftsModal()">‚úï</button>
    </div>
    <div class="mBody" style="flex:1; overflow-y:auto; padding:20px;">
      <div id="openShiftsList" style="min-height:100px;">
        <div style="text-align:center; color:var(--text-secondary); padding:20px;">Loading open shifts...</div>
      </div>
    </div>
  </div>
</div>

<!-- Fill Open Shift Modal -->
<div id="fillShiftModal" class="overlay" style="display:none;" onclick="if(event.target===this) closeFillShiftModal()">
  <div class="modal" style="width:400px; max-width:95%;">
    <div class="mHead" style="background:linear-gradient(135deg, var(--modal-gradient-start) 0%, var(--modal-gradient-end) 100%); border-bottom:none;">
      <span class="mTitle" style="color:white;">üë§ Assign Agent</span>
      <button type="button" class="btn ghost" style="padding:6px 12px; color:white; background:rgba(255,255,255,0.15); border:1px solid rgba(255,255,255,0.25);" onclick="closeFillShiftModal()">‚úï</button>
    </div>
    <div class="mBody" style="padding:20px;">
      <div id="fillShiftInfo" style="background:var(--bg-tertiary); border-radius:10px; padding:14px; margin-bottom:16px;">
        <!-- Shift info populated dynamically -->
      </div>
      
      <div style="margin-bottom:16px;">
        <label style="display:block; font-size:12px; font-weight:700; color:var(--text-secondary); margin-bottom:8px; text-transform:uppercase;">Select Agent</label>
        <select id="fillShiftAgent" style="width:100%; padding:12px; border:2px solid var(--border-color); border-radius:10px; font-size:14px; background:var(--input-bg); color:var(--text-primary);">
          <option value="">-- Select an agent --</option>
        </select>
      </div>
      
      <div style="margin-bottom:20px;">
        <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
          <input type="checkbox" id="fillShiftNotify" checked style="width:18px; height:18px; accent-color:var(--accent-primary);">
          <span style="font-size:13px; color:var(--text-primary);">Notify agent via Google Chat</span>
        </label>
      </div>
      
      <button onclick="submitFillShift()" style="
        width:100%;
        padding:14px;
        background:linear-gradient(135deg, var(--modal-gradient-start) 0%, var(--modal-gradient-end) 100%);
        color:white;
        border:none;
        border-radius:10px;
        font-size:14px;
        font-weight:700;
        cursor:pointer;
        box-shadow:0 4px 12px var(--modal-btn-shadow);
        transition:all 0.2s;
      " onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 6px 16px var(--modal-btn-hover-shadow)';"
         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px var(--modal-btn-shadow)';">
        Assign Agent ‚Üí
      </button>
    </div>
  </div>
</div>





<!-- Batch Fill Coverage Modal -->
<div id="batchFillModal" style="
  display:none;
  position:fixed;
  top:0; left:0; right:0; bottom:0;
  background:rgba(0,0,0,0.5);
  z-index:15000;
  justify-content:center;
  align-items:center;
" onclick="if(event.target===this) closeBatchFillModal()">
  <div style="
    background:white;
    border-radius:20px;
    width:600px;
    max-width:95%;
    max-height:85vh;
    overflow-y:auto;
    box-shadow:0 25px 80px rgba(0,0,0,0.35);
  ">
    <!-- Header -->
    <div style="
      padding:20px 24px;
      background:linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
      border-radius:20px 20px 0 0;
      display:flex;
      justify-content:space-between;
      align-items:center;
    ">
      <div style="font-weight:700; font-size:18px; color:white;">‚ö° Quick Fill Coverage</div>
      <button onclick="closeBatchFillModal()" style="background:rgba(255,255,255,0.2); border:none; font-size:18px; cursor:pointer; color:white; width:32px; height:32px; border-radius:8px;">&times;</button>
    </div>
    
    <div style="padding:24px;">
      <p style="font-size:13px; color:#64748b; margin:0 0 16px 0;">Assign replacements for all gaps at once. Select who should cover each open slot.</p>
      <div id="batchFillContent">
        <!-- Populated by JS -->
      </div>
      
      <!-- Actions -->
      <div style="display:flex; gap:10px; margin-top:20px; padding-top:16px; border-top:1px solid #e2e8f0;">
        <button onclick="closeBatchFillModal()" style="flex:1; padding:12px; background:#f1f5f9; color:#475569; border:1px solid #e2e8f0; border-radius:10px; font-weight:600; cursor:pointer;">Cancel</button>
        <button id="batchFillSubmitBtn" onclick="submitBatchFill()" style="flex:2; padding:12px; background:linear-gradient(135deg, #dc2626 0%, #991b1b 100%); color:white; border:none; border-radius:10px; font-weight:700; cursor:pointer; box-shadow:0 4px 12px rgba(220,38,38,0.3);">
          ‚ö° Assign All ‚Üí
        </button>
      </div>
    </div>
  </div>
</div>



  <script src="/app/app-core.js"></script>
  <script src="/app/app-schedule.js"></script>
  <script src="/app/app-agent.js"></script>
</body>
</html>
